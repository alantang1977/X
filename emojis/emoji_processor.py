import json
import re
from pathlib import Path
from typing import Dict, List

# å®Œæ•´çš„å®‰å“ç³»ç»Ÿæ”¯æŒ Emoji è¡¨æƒ…åˆ†ç±»
ANDROID_EMOJI_CATEGORIES = {
    "äººç‰©å’Œèº«ä½“": [
        "ğŸ‘¶","ğŸ§’","ğŸ‘¦","ğŸ‘§","ğŸ§‘","ğŸ‘¨","ğŸ‘©","ğŸ§“","ğŸ‘´","ğŸ‘µ",
        "ğŸ‘®","ğŸ¦¸","ğŸ§™","ğŸš´","ğŸ‘¨â€âš•ï¸","ğŸ‘©â€âš•ï¸","ğŸ‘¨â€ğŸ“","ğŸ‘©â€ğŸ“","ğŸ‘¨â€ğŸ«","ğŸ‘©â€ğŸ«",
        "ğŸ‘¨â€âš–ï¸","ğŸ‘©â€âš–ï¸","ğŸ‘¨â€ğŸŒ¾","ğŸ‘©â€ğŸŒ¾","ğŸ‘¨â€ğŸ³","ğŸ‘©â€ğŸ³","ğŸ‘¨â€ğŸ”§","ğŸ‘©â€ğŸ”§","ğŸ‘¨â€ğŸ­","ğŸ‘©â€ğŸ­",
        "ğŸ‘¨â€ğŸ’¼","ğŸ‘©â€ğŸ’¼","ğŸ‘¨â€ğŸ”¬","ğŸ‘©â€ğŸ”¬","ğŸ‘¨â€ğŸ’»","ğŸ‘©â€ğŸ’»","ğŸ‘¨â€ğŸ¤","ğŸ‘©â€ğŸ¤","ğŸ‘¨â€ğŸ¨","ğŸ‘©â€ğŸ¨",
        "ğŸ‘¨â€âœˆï¸","ğŸ‘©â€âœˆï¸","ğŸ‘¨â€ğŸš€","ğŸ‘©â€ğŸš€","ğŸ‘¨â€ğŸš’","ğŸ‘©â€ğŸš’","ğŸ•µï¸","ğŸ’‚","ğŸ¥·","ğŸ‘·",
        "ğŸ¤´","ğŸ‘¸","ğŸ‘³","ğŸ‘²","ğŸ§•","ğŸ¤µ","ğŸ‘°","ğŸ¤°","ğŸ¤±","ğŸ‘¼",
        "ğŸ’†","ğŸ’‡","ğŸš¶","ğŸ§","ğŸ§","ğŸƒ","ğŸ’ƒ","ğŸ•º","ğŸ•´ï¸","ğŸ‘¯",
        "ğŸ§–","ğŸ§—","ğŸ¤º","ğŸ‡","â›·ï¸","ğŸ‚","ğŸŒï¸","ğŸ„","ğŸš£","ğŸŠ",
        "â›¹ï¸","ğŸ‹ï¸","ğŸš´","ğŸšµ","ğŸ¤¸","ğŸ¤¼","ğŸ¤½","ğŸ¤¾","ğŸ¤¹","ğŸ§˜",
        "ğŸ›€","ğŸ›Œ","ğŸ‘­","ğŸ‘«","ğŸ‘¬","ğŸ’","ğŸ’‘","ğŸ‘ª"
    ],
    "é£Ÿç‰©å’Œé¥®æ–™": [
        "ğŸ","ğŸ","ğŸ","ğŸŠ","ğŸ‹","ğŸŒ","ğŸ‰","ğŸ‡","ğŸ“","ğŸ«","ğŸˆ",
        "ğŸ’","ğŸ‘","ğŸ¥­","ğŸ","ğŸ¥¥","ğŸ¥","ğŸ…","ğŸ†","ğŸ¥‘","ğŸ¥¦","ğŸ¥¬",
        "ğŸ¥’","ğŸŒ¶ï¸","ğŸ«‘","ğŸŒ½","ğŸ¥•","ğŸ«’","ğŸ¥”","ğŸ ","ğŸ¥","ğŸ¥¯","ğŸ",
        "ğŸ¥–","ğŸ¥¨","ğŸ§€","ğŸ¥š","ğŸ³","ğŸ§ˆ","ğŸ¥","ğŸ§‡","ğŸ¥“","ğŸ¥©","ğŸ—",
        "ğŸ–","ğŸŒ­","ğŸ”","ğŸŸ","ğŸ•","ğŸ«“","ğŸ¥ª","ğŸ¥™","ğŸŒ®","ğŸŒ¯","ğŸ«”",
        "ğŸ¥—","ğŸ","ğŸœ","ğŸ²","ğŸ›","ğŸ£","ğŸ±","ğŸ¥Ÿ","ğŸ¦ª","ğŸ¤","ğŸ™",
        "ğŸš","ğŸ˜","ğŸ¥","ğŸ¥ ","ğŸ¥®","ğŸ¢","ğŸ¡","ğŸ§","ğŸ¨","ğŸ¦","ğŸ¥§",
        "ğŸ§","ğŸ°","ğŸ‚","ğŸ®","ğŸ­","ğŸ¬","ğŸ«","ğŸ¿","ğŸ§‹","ğŸ©","ğŸª"
    ],
    "æ—…è¡Œå’Œåœ°ç‚¹": [
        "ğŸš—","ğŸš•","ğŸš™","ğŸšŒ","ğŸš","ğŸï¸","ğŸš“","ğŸš‘","ğŸš’","ğŸš","ğŸ›»",
        "ğŸšš","ğŸš›","ğŸšœ","ğŸ¦¯","ğŸ¦½","ğŸ¦¼","ğŸš²","ğŸ›´","ğŸ›µ","ğŸï¸","ğŸ›º",
        "ğŸš¨","ğŸš”","ğŸš","ğŸš˜","ğŸš–","ğŸš¡","ğŸš ","ğŸšŸ","ğŸšƒ","ğŸš‹","ğŸš",
        "ğŸš","ğŸš„","ğŸš…","ğŸšˆ","ğŸš‚","ğŸš†","ğŸš‡","ğŸšŠ","ğŸš‰","âœˆï¸","ğŸ›«",
        "ğŸ›¬","ğŸ›°ï¸","ğŸš€","ğŸ›¸","ğŸš","ğŸ›¶","â›µ","ğŸ›¥ï¸","ğŸš¤","ğŸ¦¢","ğŸ¦©",
        "ğŸ—¼","ğŸ—½","ğŸ—¿","ğŸ—»","ğŸ”ï¸","â›°ï¸","ğŸŒ‹","ğŸ•ï¸","ğŸ–ï¸","ğŸœï¸","ğŸï¸",
        "ğŸŸï¸","ğŸ›ï¸","ğŸ—ï¸","ğŸ§±","ğŸ˜ï¸","ğŸšï¸","ğŸ ","ğŸ¡","ğŸ¢","ğŸ£","ğŸ¤",
        "ğŸ¥","ğŸ¦","ğŸ¨","ğŸ©","ğŸª","ğŸ«","ğŸ¬","ğŸ­","ğŸ¯","ğŸ°","ğŸ’’",
        "ğŸ•Œ","ğŸ•","ğŸ›•","ğŸ•‹","â›ª","ğŸ›¤ï¸","ğŸ›£ï¸","ğŸŒ","ğŸŒƒ","ğŸ™ï¸","ğŸŒ„"
    ],
    # å¯ä»¥æ ¹æ®éœ€æ±‚ç»§ç»­æ·»åŠ å…¶ä»–åˆ†ç±»ï¼Œå¦‚ï¼šæ´»åŠ¨ã€åŠ¨ç‰©å’Œè‡ªç„¶ã€ç¬¦å·ç­‰
}

# å°†æ‰€æœ‰åˆ†ç±»æ‰å¹³åŒ–ä¸ºå•ä¸€çš„è¡¨æƒ…åˆ—è¡¨
ANDROID_EMOJIS = [emoji for category in ANDROID_EMOJI_CATEGORIES.values() for emoji in category]


def extract_emojis(text: str) -> List[str]:
    """æå–å­—ç¬¦ä¸²ä¸­æ‰€æœ‰å”¯ä¸€çš„ Unicode è¡¨æƒ…ç¬¦å·"""
    emoji_pattern = re.compile(
        '['
        '\U0001F600-\U0001F64F'
        '\U0001F300-\U0001F5FF'
        '\U0001F680-\U0001F6FF'
        '\U0001F1E0-\U0001F1FF'
        '\U00002500-\U00002BEF'
        '\U00002702-\U000027B0'
        '\U000024C2-\U0001F251'
        '\U0001F900-\U0001F9FF'
        '\U0001FA70-\U0001FAFF'
        ']+',
        flags=re.UNICODE
    )
    return list(set(emoji_pattern.findall(text)))


def create_emoji_mapping(emojis: List[str]) -> Dict[str, str]:
    """
    åˆ›å»ºè¡¨æƒ…ç¬¦å·åˆ°å®‰å“è¡¨æƒ…çš„æ˜ å°„
    è§„åˆ™ï¼š
    1. æ¯ä¸ªåŸå§‹è¡¨æƒ…æ˜ å°„åˆ°å”¯ä¸€çš„å®‰å“è¡¨æƒ…
    2. å¦‚æœå®‰å“è¡¨æƒ…ç”¨å°½ï¼Œåˆ™é‡æ–°å¼€å§‹åˆ†é…
    """
    sorted_emojis = sorted(emojis)
    mapping = {}
    emoji_pool = ANDROID_EMOJIS.copy()

    for emoji in sorted_emojis:
        if not emoji_pool:
            emoji_pool = ANDROID_EMOJIS.copy()
        mapping[emoji] = emoji_pool.pop(0)
    return mapping


def process_text(text: str, mapping: Dict[str, str]) -> str:
    """ä½¿ç”¨æ˜ å°„æ›¿æ¢æ–‡æœ¬ä¸­çš„æ‰€æœ‰è¡¨æƒ…ç¬¦å·"""
    for orig, replacement in mapping.items():
        text = text.replace(orig, replacement)
    return text


def main():
    input_path = Path('input.json')
    output_path = Path('output.json')

    # è¯»å–å¹¶è§£æå†…å®¹
    content = input_path.read_text(encoding='utf-8')
    try:
        # å°è¯•åŠ è½½ JSON ï¼Œä¿æŒç»“æ„
        data = json.loads(content)
        text = json.dumps(data, ensure_ascii=False)
    except json.JSONDecodeError:
        # å¦‚æœä¸æ˜¯ä¸¥æ ¼ JSONï¼Œå°±å½“ä½œæ™®é€šæ–‡æœ¬å¤„ç†
        text = content

    # æå–å¹¶æ˜ å°„
    found = extract_emojis(text)
    mapping = create_emoji_mapping(found)
    processed = process_text(text, mapping)

    # å†™å…¥æ–‡ä»¶
    output_path.write_text(processed, encoding='utf-8')
    print(f"å¤„ç†å®Œæˆï¼šæ›¿æ¢ {len(mapping)} ä¸ªè¡¨æƒ…ç¬¦å·ï¼Œç»“æœå·²å†™å…¥ {output_path}")


if __name__ == '__main__':
    main()
