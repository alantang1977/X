import json
import re
from pathlib import Path
from typing import Dict, List

# å®Œæ•´çš„å®‰å“æ”¯æŒè¡¨æƒ…ç¬¦å·åˆ—è¡¨
ANDROID_EMOJIS = [
    "ğŸ‘®", "ğŸ¦¸", "ğŸ§™", "ğŸš´", "ğŸ‘¨â€âš•ï¸", "ğŸ‘©â€âš•ï¸", "ğŸ‘¨â€ğŸ“", "ğŸ‘©â€ğŸ“", "ğŸ‘¨â€ğŸ«", "ğŸ‘©â€ğŸ«",
    "ğŸ‘¨â€âš–ï¸", "ğŸ‘©â€âš–ï¸", "ğŸ‘¨â€ğŸŒ¾", "ğŸ‘©â€ğŸŒ¾", "ğŸ‘¨â€ğŸ³", "ğŸ‘©â€ğŸ³", "ğŸ‘¨â€ğŸ”§", "ğŸ‘©â€ğŸ”§", "ğŸ‘¨â€ğŸ­", "ğŸ‘©â€ğŸ­",
    "ğŸ‘¨â€ğŸ’¼", "ğŸ‘©â€ğŸ’¼", "ğŸ‘¨â€ğŸ”¬", "ğŸ‘©â€ğŸ”¬", "ğŸ‘¨â€ğŸ’»", "ğŸ‘©â€ğŸ’»", "ğŸ‘¨â€ğŸ¤", "ğŸ‘©â€ğŸ¤", "ğŸ‘¨â€ğŸ¨", "ğŸ‘©â€ğŸ¨",
    "ğŸ‘¨â€âœˆï¸", "ğŸ‘©â€âœˆï¸", "ğŸ‘¨â€ğŸš€", "ğŸ‘©â€ğŸš€", "ğŸ‘¨â€ğŸš’", "ğŸ‘©â€ğŸš’", "ğŸ•µï¸", "ğŸ’‚", "ğŸ¥·", "ğŸ‘·",
    "ğŸ¤´", "ğŸ‘¸", "ğŸ‘³", "ğŸ‘²", "ğŸ§•", "ğŸ¤µ", "ğŸ‘°", "ğŸ¤°", "ğŸ¤±", "ğŸ‘¼",
    "ğŸ…", "ğŸ¤¶", "ğŸ§‘â€ğŸ„", "ğŸ¦¸", "ğŸ¦¹", "ğŸ§™", "ğŸ§š", "ğŸ§›", "ğŸ§œ", "ğŸ§",
    "ğŸ§", "ğŸ§Ÿ", "ğŸ’†", "ğŸ’‡", "ğŸš¶", "ğŸ§", "ğŸ§", "ğŸƒ", "ğŸ’ƒ", "ğŸ•º",
    "ğŸ•´ï¸", "ğŸ‘¯", "ğŸ§–", "ğŸ§—", "ğŸ¤º", "ğŸ‡", "â›·ï¸", "ğŸ‚", "ğŸŒï¸", "ğŸ„",
    "ğŸš£", "ğŸŠ", "â›¹ï¸", "ğŸ‹ï¸", "ğŸš´", "ğŸšµ", "ğŸ¤¸", "ğŸ¤¼", "ğŸ¤½", "ğŸ¤¾",
    "ğŸ¤¹", "ğŸ§˜", "ğŸ›€", "ğŸ›Œ", "ğŸ‘­", "ğŸ‘«", "ğŸ‘¬", "ğŸ’", "ğŸ’‘", "ğŸ‘ª",
    "â¤ï¸", "ğŸ‰", "â°", "ğŸ˜Š", "ğŸ˜„", "ğŸ˜ƒ", "ğŸ˜‚", "ğŸ¤£", "ğŸ˜", "ğŸ¥°",
    "ğŸ˜˜", "ğŸ˜—", "ğŸ˜š", "ğŸ˜™", "ğŸ¥²", "ğŸ˜", "ğŸ˜³", "ğŸ¥º", "ğŸ˜­", "ğŸ˜¡",
    "ğŸ¤¬", "ğŸ¤¯", "ğŸ¥¶", "ğŸ¥µ", "ğŸ˜±", "ğŸ˜¨", "ğŸ˜°", "ğŸ˜¥", "ğŸ˜“", "ğŸ¤—",
    "ğŸ¤”", "ğŸ¤­", "ğŸ¤«", "ğŸ¤¥", "ğŸ˜¶", "ğŸ˜", "ğŸ˜‘", "ğŸ˜¬", "ğŸ™„", "ğŸ˜ª",
    "ğŸ˜´", "ğŸ˜·", "ğŸ¤§", "ğŸ¤®", "ğŸ¤¢", "ğŸ¥´", "ğŸ˜µ", "ğŸ¤ ", "ğŸ¥³", "ğŸ˜",
    "ğŸ¤“", "ğŸ§", "ğŸ˜•", "ğŸ˜Ÿ", "ğŸ™", "â˜¹ï¸", "ğŸ˜®", "ğŸ˜¯", "ğŸ˜²", "ğŸ˜¦",
    "ğŸ˜§", "ğŸ™‚", "ğŸ™ƒ", "â˜ºï¸", "ğŸ˜‡", "ğŸ¤©", "ğŸ¥¸", "ğŸ¤ª", "ğŸ¤¨", "ğŸ¥±",
    "ğŸ˜ˆ", "ğŸ‘¿", "ğŸ’€", "â˜ ï¸", "ğŸ’©", "ğŸ¤¡", "ğŸ‘¹", "ğŸ‘º", "ğŸ‘»", "ğŸ‘½",
    "ğŸ‘¾", "ğŸ¤–", "ğŸ˜º", "ğŸ˜¸", "ğŸ˜¹", "ğŸ˜»", "ğŸ˜¼", "ğŸ˜½", "ğŸ™€", "ğŸ˜¿",
    "ğŸ˜¾", "ğŸ‘‹", "ğŸ¤š", "ğŸ–ï¸", "âœ‹", "ğŸ––", "ğŸ‘Œ", "ğŸ¤Œ", "ğŸ¤", "âœŒï¸",
    "ğŸ¤", "ğŸ¤Ÿ", "ğŸ¤˜", "ğŸ¤™", "ğŸ‘ˆ", "ğŸ‘‰", "ğŸ‘†", "ğŸ–•", "ğŸ‘‡", "â˜ï¸",
    "ğŸ‘", "ğŸ‘", "âœŠ", "ğŸ‘Š", "ğŸ¤›", "ğŸ¤œ", "ğŸ‘", "ğŸ™Œ", "ğŸ‘", "ğŸ¤²",
    "ğŸ™", "âœï¸", "ğŸ’…", "ğŸ¤³", "ğŸ’ª", "ğŸ¦¾", "ğŸ¦µ", "ğŸ¦¿", "ğŸ¦¶", "ğŸ‘‚",
    "ğŸ¦»", "ğŸ‘ƒ", "ğŸ§ ", "ğŸ«€", "ğŸ«", "ğŸ¦·", "ğŸ¦´", "ğŸ‘€", "ğŸ‘…", "ğŸ‘„",
    "ğŸ‘¶", "ğŸ§’", "ğŸ‘¦", "ğŸ‘§", "ğŸ§‘", "ğŸ‘¨", "ğŸ‘©", "ğŸ§“", "ğŸ‘´", "ğŸ‘µ"
]

def extract_emojis(text: str) -> List[str]:
    """æå–å­—ç¬¦ä¸²ä¸­æ‰€æœ‰å”¯ä¸€çš„Unicodeè¡¨æƒ…ç¬¦å·"""
    emoji_pattern = re.compile(
        "["
        "\U0001F600-\U0001F64F"  # è¡¨æƒ…ç¬¦å·
        "\U0001F300-\U0001F5FF"  # ç¬¦å·å’Œè±¡å½¢æ–‡å­—
        "\U0001F680-\U0001F6FF"  # äº¤é€šå’Œåœ°å›¾ç¬¦å·
        "\U0001F1E0-\U0001F1FF"  # å›½æ——
        "\U00002500-\U00002BEF"  # å…¶ä»–ç¬¦å·
        "\U00002702-\U000027B0"
        "\U000024C2-\U0001F251"
        "\U0001f926-\U0001f937"
        "\U0001F900-\U0001F9FF"  # è¡¥å……ç¬¦å·
        "\U0001FA70-\U0001FAFF"  # æ‰©å±•
        "]+",
        flags=re.UNICODE
    )
    return list(set(emoji_pattern.findall(text)))

def create_emoji_mapping(emojis: List[str]) -> Dict[str, str]:
    """
    åˆ›å»ºè¡¨æƒ…ç¬¦å·åˆ°å®‰å“è¡¨æƒ…çš„æ˜ å°„
    è§„åˆ™ï¼š
    1. æ¯ä¸ªåŸå§‹è¡¨æƒ…æ˜ å°„åˆ°å”¯ä¸€çš„å®‰å“è¡¨æƒ…
    2. å¦‚æœå®‰å“è¡¨æƒ…ç”¨å°½ï¼Œåˆ™é‡æ–°å¼€å§‹åˆ†é…
    """
    sorted_emojis = sorted(emojis)  # æ’åºç¡®ä¿ä¸€è‡´æ€§
    mapping = {}
    
    # åˆ›å»ºå®‰å“è¡¨æƒ…æ± 
    emoji_pool = ANDROID_EMOJIS.copy()
    
    for emoji in sorted_emojis:
        if not emoji_pool:
            # å¦‚æœè¡¨æƒ…æ± ç”¨å°½ï¼Œé‡æ–°å¡«å……
            emoji_pool = ANDROID_EMOJIS.copy()
        
        # åˆ†é…ä¸‹ä¸€ä¸ªå®‰å“è¡¨æƒ…
        android_emoji = emoji_pool[0]
        mapping[emoji] = android_emoji
        emoji_pool.remove(android_emoji)  # ä»æ± ä¸­ç§»é™¤å·²ä½¿ç”¨çš„è¡¨æƒ…
    
    return mapping

def process_json_file(file_path: Path, mapping: Dict[str, str]) -> str:
    """å¤„ç†JSONæ–‡ä»¶å¹¶è¿”å›å†…å®¹ï¼Œä¿æŒåŸå§‹æ ¼å¼"""
    content = file_path.read_text(encoding='utf-8')
    return replace_emojis(content, mapping)

def replace_emojis(text: str, mapping: Dict[str, str]) -> str:
    """ä½¿ç”¨æ˜ å°„æ›¿æ¢æ–‡æœ¬ä¸­çš„æ‰€æœ‰è¡¨æƒ…ç¬¦å·"""
    for orig, replacement in mapping.items():
        text = text.replace(orig, replacement)
    return text

def main():
    # æ–‡ä»¶è·¯å¾„é…ç½®
    input_file = Path('input.json')  # æ‚¨çš„JSONæ–‡ä»¶
    output_file = Path('output.json')  # è¾“å‡ºæ–‡ä»¶
    
    # è¯»å–æ–‡ä»¶å†…å®¹
    content = input_file.read_text(encoding='utf-8')
    
    # æå–æ‰€æœ‰å”¯ä¸€è¡¨æƒ…ç¬¦å·
    all_emojis = extract_emojis(content)
    
    # åˆ›å»ºå…¨å±€è¡¨æƒ…æ˜ å°„
    emoji_mapping = create_emoji_mapping(all_emojis)
    
    # å¤„ç†æ–‡ä»¶
    processed_content = replace_emojis(content, emoji_mapping)
    
    # ä¿å­˜å¤„ç†åçš„å†…å®¹
    with output_file.open('w', encoding='utf-8') as f:
        f.write(processed_content)
    
    print(f"å¤„ç†å®Œæˆï¼ç»“æœå·²ä¿å­˜è‡³ {output_file}")
    print(f"æ›¿æ¢äº† {len(emoji_mapping)} ä¸ªä¸åŒçš„è¡¨æƒ…ç¬¦å·")
    print("ç¤ºä¾‹æ˜ å°„:")
    for orig, new in list(emoji_mapping.items())[:5]:
        print(f"{orig} â†’ {new}")

if __name__ == "__main__":
    main()
