# emojis/emojis.py
import re
import random
import os
import glob

# å®šä¹‰ä¸€ä¸ªåŒ…å«å¤šç§Emojiçš„åˆ—è¡¨
emoji_list = [
    # é£Ÿç‰©å’Œé¥®æ–™ç›¸å…³Emoji (156ä¸ª)
    "ğŸ", "ğŸ", "ğŸ", "ğŸŠ", "ğŸ‹", "ğŸŒ", "ğŸ‰", "ğŸ‡", "ğŸ“", "ğŸ«",
    "ğŸˆ", "ğŸ’", "ğŸ‘", "ğŸ¥­", "ğŸ", "ğŸ¥¥", "ğŸ¥", "ğŸ…", "ğŸ«’", "ğŸ¥‘",
    "ğŸ†", "ğŸ¥”", "ğŸ¥•", "ğŸŒ½", "ğŸŒ¶ï¸", "ğŸ«‘", "ğŸ¥’", "ğŸ¥¬", "ğŸ¥¦", "ğŸ§„",
    "ğŸ§…", "ğŸ„", "ğŸ¥œ", "ğŸŒ°", "ğŸ", "ğŸ¥", "ğŸ¥–", "ğŸ«“", "ğŸ¥¨", "ğŸ¥¯",
    "ğŸ¥", "ğŸ§‡", "ğŸ§€", "ğŸ–", "ğŸ—", "ğŸ¥©", "ğŸ¥“", "ğŸ”", "ğŸŸ", "ğŸ•",
    "ğŸŒ®", "ğŸŒ¯", "ğŸ«”", "ğŸ¥™", "ğŸ§†", "ğŸ¥š", "ğŸ³", "ğŸ¥˜", "ğŸ²", "ğŸ«•",
    "ğŸ¥£", "ğŸ¥—", "ğŸ±", "ğŸ˜", "ğŸ™", "ğŸš", "ğŸ›", "ğŸœ", "ğŸ", "ğŸ ",
    "ğŸ¢", "ğŸ£", "ğŸ¤", "ğŸ¥", "ğŸ¥®", "ğŸ¡", "ğŸ¥Ÿ", "ğŸ¥ ", "ğŸ¥¡", "ğŸ¦€",
    "ğŸ¦", "ğŸ¦", "ğŸ¦‘", "ğŸ¦", "ğŸ§", "ğŸ¨", "ğŸ¥§", "ğŸ°", "ğŸ‚", "ğŸ®",
    "ğŸ­", "ğŸ¬", "ğŸ«", "ğŸ¿", "ğŸ©", "ğŸª", "ğŸŒ°", "ğŸ¥œ", "ğŸ§‚", "ğŸ«˜",
    "ğŸ¯", "ğŸ§ˆ", "ğŸ¥›", "ğŸ¼", "â˜•", "ğŸ«–", "ğŸµ", "ğŸ¶", "ğŸ¾", "ğŸ·",
    "ğŸ¸", "ğŸ¹", "ğŸº", "ğŸ»", "ğŸ¥‚", "ğŸ¥ƒ", "ğŸ¥¤", "ğŸ§‹", "ğŸ§ƒ", "ğŸ§‰",
    "ğŸ§Š", "ğŸ¥¢", "ğŸ½ï¸", "ğŸ”ª", "ğŸ´", "ğŸ¥„", "ğŸ§‚", "ğŸ§‚", "ğŸ§‚", "ğŸ§‚",
    "ğŸš", "ğŸœ", "ğŸ", "ğŸŸ", "ğŸ”", "ğŸ•", "ğŸŒ®", "ğŸŒ¯", "ğŸ¥ª", "ğŸ¥™",
    "ğŸ³", "ğŸ˜", "ğŸ™", "ğŸ¢", "ğŸ¡", "ğŸ§", "ğŸ¨", "ğŸ¦", "ğŸ°", "ğŸ‚",
    "ğŸ¬", "ğŸ­", "ğŸ«", "ğŸ¿", "ğŸ©", "ğŸª", "ğŸŒ°", "ğŸ¥œ", "ğŸ§‚", "ğŸ«˜",
    "ğŸ¯", "ğŸ§ˆ", "ğŸ¥›", "ğŸ¼", "â˜•", "ğŸ«–", "ğŸµ", "ğŸ¶", "ğŸ¾", "ğŸ·",
    "ğŸ¸", "ğŸ¹", "ğŸº", "ğŸ»", "ğŸ¥‚", "ğŸ¥ƒ", "ğŸ¥¤", "ğŸ§‹", "ğŸ§ƒ", "ğŸ§‰",
    
    # åŠ¨ç‰©å’Œè‡ªç„¶ç›¸å…³Emoji (182ä¸ª)
    "ğŸ¶", "ğŸ±", "ğŸ­", "ğŸ¹", "ğŸ°", "ğŸ¦Š", "ğŸ»", "ğŸ¼", "ğŸ¨", "ğŸ¯",
    "ğŸ¦", "ğŸ®", "ğŸ·", "ğŸ¸", "ğŸµ", "ğŸ”", "ğŸ§", "ğŸ¦", "ğŸ¤", "ğŸ£",
    "ğŸ¥", "ğŸ¦†", "ğŸ¦…", "ğŸ¦‰", "ğŸ¦‡", "ğŸº", "ğŸ—", "ğŸ´", "ğŸ¦„", "ğŸ",
    "ğŸ›", "ğŸ¦‹", "ğŸŒ", "ğŸ", "ğŸœ", "ğŸ•·ï¸", "ğŸ¦‚", "ğŸ¦Ÿ", "ğŸ¦—", "ğŸ¢",
    "ğŸ", "ğŸ¦", "ğŸ¦–", "ğŸ¦•", "ğŸ™", "ğŸ¦‘", "ğŸ¦", "ğŸ¦€", "ğŸ¡", "ğŸ ",
    "ğŸŸ", "ğŸ¬", "ğŸ³", "ğŸ‹", "ğŸ¦ˆ", "ğŸŠ", "ğŸ…", "ğŸ†", "ğŸ¦“", "ğŸ¦",
    "ğŸ¦§", "ğŸ¦£", "ğŸ˜", "ğŸ¦›", "ğŸ¦", "ğŸª", "ğŸ«", "ğŸ¦’", "ğŸ¦˜", "ğŸ¦¬",
    "ğŸƒ", "ğŸ‚", "ğŸ„", "ğŸ", "ğŸ–", "ğŸ", "ğŸ‘", "ğŸ", "ğŸ¦Œ", "ğŸ¦™",
    "ğŸ¦¥", "ğŸ¦˜", "ğŸ¦¨", "ğŸ¦¡", "ğŸ¦ƒ", "ğŸ•Šï¸", "ğŸ¦¢", "ğŸ¦š", "ğŸ¦œ", "ğŸ¦",
    "ğŸ•â€ğŸ¦º", "ğŸ¦®", "ğŸ•", "ğŸˆ", "ğŸˆâ€â¬›", "ğŸ¾", "ğŸŒ±", "ğŸŒ²", "ğŸŒ³", "ğŸŒ´",
    "ğŸŒµ", "ğŸŒ¾", "ğŸŒ¿", "ğŸ€", "ğŸ", "ğŸƒ", "ğŸ‚", "ğŸŒ¼", "ğŸŒ»", "ğŸŒ·",
    "ğŸŒ¹", "ğŸ¥€", "ğŸŒº", "ğŸŒ¸", "ğŸ’", "ğŸŒ±", "ğŸŒ¾", "ğŸŒ¿", "ğŸ€", "ğŸ",
    "ğŸƒ", "ğŸ‚", "ğŸŒ¼", "ğŸŒ»", "ğŸŒ·", "ğŸŒ¹", "ğŸ¥€", "ğŸŒº", "ğŸŒ¸", "ğŸ’",
    "ğŸŒ", "ğŸŒ", "ğŸŒ", "ğŸŒ•", "ğŸŒ–", "ğŸŒ—", "ğŸŒ˜", "ğŸŒ‘", "ğŸŒ’", "ğŸŒ“",
    "ğŸŒ”", "ğŸŒ™", "ğŸŒš", "ğŸŒ›", "ğŸŒœ", "ğŸŒŸ", "â­", "ğŸ’«", "ğŸŒ ", "â˜ï¸",
    "ğŸŒˆ", "ğŸŒ¤ï¸", "â›…", "ğŸŒ¥ï¸", "ğŸŒ¦ï¸", "ğŸŒ§ï¸", "â›ˆï¸", "ğŸŒ©ï¸", "ğŸŒ¨ï¸", "â„ï¸",
    "â˜ƒï¸", "â›„", "ğŸ’¨", "ğŸ’§", "ğŸ’¦", "ğŸŒŠ", "ğŸŒ«ï¸", "ğŸŒªï¸", "ğŸ”¥", "ğŸ—»",
    "ğŸ”ï¸", "ğŸŒ‹", "ğŸ—¾", "ğŸï¸", "ğŸœï¸", "ğŸŒ…", "ğŸŒ„", "ğŸŒ‡", "ğŸŒ†", "ğŸŒ‰",
    "ğŸŒŒ", "ğŸŒƒ", "ğŸŒ™", "ğŸŒš", "ğŸŒ›", "ğŸŒœ", "ğŸŒŸ", "â­", "ğŸ’«", "ğŸŒ ",
    "â˜ï¸", "ğŸŒˆ", "ğŸŒ¤ï¸", "â›…", "ğŸŒ¥ï¸", "ğŸŒ¦ï¸", "ğŸŒ§ï¸", "â›ˆï¸", "ğŸŒ©ï¸", "ğŸŒ¨ï¸",
    "â„ï¸", "â˜ƒï¸", "â›„", "ğŸ’¨", "ğŸ’§", "ğŸ’¦", "ğŸŒŠ", "ğŸŒ«ï¸", "ğŸŒªï¸", "ğŸ”¥",
    
    # æ—…è¡Œå’Œåœ°ç‚¹ç›¸å…³Emoji (211ä¸ª)
    "âœˆï¸", "ğŸ›«", "ğŸ›¬", "ğŸš", "ğŸš€", "ğŸ›¸", "ğŸš¢", "ğŸ›³ï¸", "â›´ï¸", "ğŸš‚",
    "ğŸš…", "ğŸš†", "ğŸšŠ", "ğŸš‰", "ğŸšŒ", "ğŸš", "ğŸš", "ğŸš", "ğŸš‘", "ğŸš’",
    "ğŸš“", "ğŸš”", "ğŸš•", "ğŸš–", "ğŸš—", "ğŸš˜", "ğŸš™", "ğŸšš", "ğŸš›", "ğŸšœ",
    "ğŸ›µ", "ğŸš²", "ğŸš", "â›½", "ğŸš§", "ğŸš¨", "ğŸš¥", "ğŸš¦", "ğŸ®", "ğŸ°",
    "ğŸ¯", "ğŸ­", "ğŸ¢", "ğŸ¬", "ğŸ¤", "ğŸ¥", "ğŸ¦", "ğŸ¨", "ğŸ©", "ğŸª",
    "ğŸ«", "ğŸ­", "ğŸ°", "ğŸ—¼", "ğŸ—½", "ğŸ—¿", "ğŸ—ºï¸", "ğŸ—¾", "ğŸï¸", "ğŸœï¸",
    "ğŸ•ï¸", "ğŸ–ï¸", "ğŸ”ï¸", "ğŸŒ‹", "ğŸ—»", "ğŸï¸", "ğŸŒ…", "ğŸŒ„", "ğŸŒ‡", "ğŸŒ†",
    "ğŸŒ‰", "ğŸŒŒ", "ğŸŒƒ", "ğŸ™ï¸", "ğŸŒƒ", "ğŸ™ï¸", "ğŸŒ†", "ğŸŒ‰", "ğŸŒ…", "ğŸŒ„",
    "ğŸŒ‡", "ğŸŒŒ", "ğŸ—ºï¸", "ğŸ—¾", "ğŸï¸", "ğŸœï¸", "ğŸ•ï¸", "ğŸ–ï¸", "ğŸ”ï¸", "ğŸŒ‹",
    "ğŸ—»", "ğŸï¸", "ğŸŒ…", "ğŸŒ„", "ğŸŒ‡", "ğŸŒ†", "ğŸŒ‰", "ğŸŒŒ", "ğŸŒƒ", "ğŸ™ï¸",
    "ğŸšª", "ğŸ›ï¸", "ğŸ›‹ï¸", "ğŸª‘", "ğŸªœ", "ğŸš½", "ğŸ›", "ğŸ›€", "ğŸš¿", "ğŸ§½",
    "ğŸ§´", "ğŸ§¼", "ğŸª¥", "ğŸª’", "ğŸª", "ğŸ›ï¸", "ğŸ›’", "ğŸ›ï¸", "ğŸ“º", "ğŸ“·",
    "ğŸ“¸", "ğŸ¥", "ğŸï¸", "ğŸ“½ï¸", "ğŸ’¿", "ğŸ’½", "ğŸ’¾", "ğŸ“€", "ğŸ–¥ï¸", "ğŸ’»",
    "ğŸ–¨ï¸", "ğŸ–±ï¸", "ğŸ–²ï¸", "ğŸ—„ï¸", "ğŸ“…", "ğŸ“†", "ğŸ“‡", "ğŸ“ˆ", "ğŸ“‰", "ğŸ“Š",
    "ğŸ“‹", "ğŸ“Œ", "ğŸ“", "ğŸ“", "ğŸ“", "ğŸ“", "âœ‚ï¸", "ğŸ–ï¸", "ğŸ–Šï¸", "ğŸ–‹ï¸",
    "âœ’ï¸", "ğŸ“", "ğŸ“„", "ğŸ“°", "ğŸ“‘", "ğŸ““", "ğŸ“”", "ğŸ“•", "ğŸ“–", "ğŸ“—",
    "ğŸ“˜", "ğŸ“™", "ğŸ“š", "ğŸ“›", "ğŸ”–", "ğŸ·ï¸", "ğŸ«", "ğŸŸï¸", "ğŸ«", "ğŸŸï¸",
    "ğŸ†", "ğŸ¥‡", "ğŸ¥ˆ", "ğŸ¥‰", "ğŸ…", "ğŸ–ï¸", "ğŸ—ï¸", "ğŸµï¸", "ğŸŒ¹", "ğŸŒº",
    "ğŸŒ¸", "ğŸ’", "ğŸŒ¼", "ğŸŒ»", "ğŸŒ·", "ğŸ¥€", "ğŸ", "ğŸ‚", "ğŸƒ", "ğŸ€",
    "ğŸŒ¿", "ğŸŒ¾", "ğŸŒµ", "ğŸŒ´", "ğŸŒ³", "ğŸŒ²", "ğŸŒ±", "ğŸ’«", "ğŸŒŸ", "â­",
    "ğŸŒ ", "ğŸŒŒ", "ğŸŒƒ", "ğŸŒ†", "ğŸŒ‡", "ğŸŒ„", "ğŸŒ…", "ğŸ™ï¸", "ğŸŒ‰", "ğŸ—¾",
    "ğŸï¸", "ğŸœï¸", "ğŸ•ï¸", "ğŸ–ï¸", "ğŸ”ï¸", "ğŸŒ‹", "ğŸ—»", "ğŸï¸", "ğŸ—ºï¸", "ğŸ—¿",
    "ğŸ—½", "ğŸ—¼", "ğŸ°", "ğŸ¯", "ğŸ¨", "ğŸ©", "ğŸ¬", "ğŸ¤", "ğŸ¥", "ğŸ¦",
    "ğŸª", "ğŸ«", "ğŸ­", "ğŸš‰", "ğŸšŠ", "ğŸš†", "ğŸš…", "ğŸš‚", "ğŸš¢", "ğŸ›³ï¸",
    "â›´ï¸", "ğŸš", "âœˆï¸", "ğŸ›«", "ğŸ›¬", "ğŸš€", "ğŸ›¸"
]

def replace_emojis_in_file(input_file_path, output_file_path):
    """
    æ›¿æ¢JSONæ–‡ä»¶ä¸­"name"å­—æ®µå€¼é‡Œçš„Emojiè¡¨æƒ…ç¬¦å·ä¸ºæ–°çš„ã€ä¸åŒçš„Emoji
    
    å‚æ•°:
    input_file_path (str): è¾“å…¥æ–‡ä»¶è·¯å¾„
    output_file_path (str): è¾“å‡ºæ–‡ä»¶è·¯å¾„
    """
    try:
        # ç¡®ä¿è¾“å‡ºç›®å½•å­˜åœ¨
        output_dir = os.path.dirname(output_file_path)
        os.makedirs(output_dir, exist_ok=True)
        
        # è¯»å–JSONæ–‡ä»¶å†…å®¹
        with open(input_file_path, 'r', encoding='utf-8') as file:
            content = file.read()
        
        # å®šä¹‰Emojiçš„æ­£åˆ™è¡¨è¾¾å¼æ¨¡å¼
        emoji_pattern = re.compile("["
                                   u"\U0001F600-\U0001F64F"  # emoticons
                                   u"\U0001F300-\U0001F5FF"  # symbols & pictographs
                                   u"\U0001F680-\U0001F6FF"  # transport & map symbols
                                   u"\U0001F1E0-\U0001F1FF"  # flags (iOS)
                                   u"\U00002702-\U000027B0"
                                   u"\U000024C2-\U0001F251"
                                   "]+", flags=re.UNICODE)
        
        # æ‰¾å‡ºæ‰€æœ‰"name":"..."æ¨¡å¼çš„å­—ç¬¦ä¸²
        name_pattern = re.compile(r'"name":"([^"]*)"')
        name_matches = name_pattern.finditer(content)
        
        # ç”¨äºè·Ÿè¸ªå·²æ›¿æ¢çš„Emojiï¼Œç¡®ä¿å”¯ä¸€æ€§
        used_emojis = set()
        total_replacements = 0
        
        # æ›¿æ¢æ¯ä¸ªåŒ¹é…çš„"name"å­—æ®µä¸­çš„Emoji
        new_content = content
        for match in reversed(list(name_matches)):  # ä»åå¾€å‰æ›¿æ¢ï¼Œé¿å…ç´¢å¼•é—®é¢˜
            name_value = match.group(1)
            emojis_in_name = emoji_pattern.findall(name_value)
            
            if not emojis_in_name:
                continue
                
            # ä¸ºæ¯ä¸ªEmojiç”Ÿæˆä¸€ä¸ªæ–°çš„ä¸åŒçš„Emoji
            new_name_value = name_value
            for old_emoji in reversed(emojis_in_name):  # ä»åå¾€å‰æ›¿æ¢ï¼Œé¿å…ç´¢å¼•é—®é¢˜
                available_emojis = [emoji for emoji in emoji_list if emoji not in used_emojis]
                if not available_emojis:
                    print(f"è­¦å‘Š: Emojiåˆ—è¡¨ä¸­çš„Emojiä¸å¤Ÿç”¨äº†ï¼Œå·²ä½¿ç”¨ {len(used_emojis)} ä¸ªä¸åŒEmojiï¼Œå°†é‡æ–°ä½¿ç”¨æ± ")
                    available_emojis = emoji_list
                new_emoji = random.choice(available_emojis)
                new_name_value = new_name_value[::-1].replace(old_emoji[::-1], new_emoji[::-1], 1)[::-1]
                used_emojis.add(new_emoji)
                total_replacements += 1
            
            # æ›´æ–°æ•´ä¸ªåŒ¹é…çš„å­—ç¬¦ä¸²
            original_text = match.group(0)
            new_text = f'"name":"{new_name_value}"'
            new_content = new_content[:match.start()] + new_text + new_content[match.end():]
        
        print(f"åœ¨æ–‡ä»¶ä¸­æ‰¾åˆ°å¹¶æ›¿æ¢äº† {total_replacements} ä¸ªEmoji")
        
        # å°†ä¿®æ”¹åçš„å†…å®¹å†™å›æ–‡ä»¶
        with open(output_file_path, 'w', encoding='utf-8') as file:
            file.write(new_content)

        print(f"Emojiæ›¿æ¢å®Œæˆï¼Œè¾“å‡ºæ–‡ä»¶: {output_file_path}")
    except FileNotFoundError:
        print(f"é”™è¯¯: æ–‡ä»¶ä¸å­˜åœ¨ - {input_file_path}")
    except Exception as e:
        print(f"å‘ç”Ÿé”™è¯¯: {e}")

def main():
    """
    ä¸»å‡½æ•°ï¼šå¤„ç†emojisæ–‡ä»¶å¤¹ä¸‹çš„æ‰€æœ‰JSONæ–‡ä»¶
    """
    # è·å–emojisæ–‡ä»¶å¤¹è·¯å¾„
    script_dir = os.path.dirname(os.path.abspath(__file__))
    input_dir = script_dir
    output_dir = os.path.join(script_dir, "output")
    
    # æŸ¥æ‰¾æ‰€æœ‰.jsonæ–‡ä»¶
    json_files = glob.glob(os.path.join(input_dir, "*.json"))
    
    if not json_files:
        print("åœ¨emojisæ–‡ä»¶å¤¹ä¸­æœªæ‰¾åˆ°JSONæ–‡ä»¶")
        return
    
    print(f"æ‰¾åˆ° {len(json_files)} ä¸ªJSONæ–‡ä»¶éœ€è¦å¤„ç†")
    
    # å¤„ç†æ¯ä¸ªJSONæ–‡ä»¶
    for json_file in json_files:
        file_name = os.path.basename(json_file)
        input_path = os.path.join(input_dir, file_name)
        output_path = os.path.join(output_dir, file_name)
        
        print(f"\nå¤„ç†æ–‡ä»¶: {file_name}")
        replace_emojis_in_file(input_path, output_path)
    
    print("\næ‰€æœ‰æ–‡ä»¶å¤„ç†å®Œæˆ")

if __name__ == "__main__":
    main()    
