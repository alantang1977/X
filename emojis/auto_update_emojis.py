import os
import json
import random
import re

# å®‰å“ç³»ç»Ÿæ”¯æŒçš„ä¸»æµ Emoji åˆ—è¡¨ï¼ˆå¯æ ¹æ®éœ€è¦è¡¥å……ï¼‰
ALL_EMOJIS = [
    # è¡¨æƒ…ç¬¦å·
    "ğŸ˜€","ğŸ˜","ğŸ˜‚","ğŸ¤£","ğŸ˜ƒ","ğŸ˜„","ğŸ˜…","ğŸ˜†","ğŸ˜‰","ğŸ˜Š","ğŸ˜‹","ğŸ˜","ğŸ˜","ğŸ˜˜","ğŸ¥°","ğŸ˜—","ğŸ˜™","ğŸ˜š",
    "ğŸ™‚","ğŸ¤—","ğŸ¤©","ğŸ¤”","ğŸ¤¨","ğŸ˜","ğŸ˜‘","ğŸ˜¶","ğŸ™„","ğŸ˜","ğŸ˜£","ğŸ˜¥","ğŸ˜®","ğŸ¤","ğŸ˜¯","ğŸ˜ª","ğŸ˜«",
    "ğŸ¥±","ğŸ˜´","ğŸ˜Œ","ğŸ˜›","ğŸ˜œ","ğŸ˜","ğŸ¤¤","ğŸ˜’","ğŸ˜“","ğŸ˜”","ğŸ˜•","ğŸ™ƒ","ğŸ¤‘","ğŸ˜²","â˜¹ï¸","ğŸ™","ğŸ˜–",
    "ğŸ˜","ğŸ˜Ÿ","ğŸ˜¤","ğŸ˜¢","ğŸ˜­","ğŸ˜¦","ğŸ˜§","ğŸ˜¨","ğŸ˜©","ğŸ¤¯","ğŸ˜¬","ğŸ˜°","ğŸ˜±","ğŸ¥µ","ğŸ¥¶","ğŸ˜³","ğŸ¤ª",
    "ğŸ˜µ","ğŸ˜¡","ğŸ˜ ","ğŸ¤¬","ğŸ˜·","ğŸ¤’","ğŸ¤•","ğŸ¤¢","ğŸ¤®","ğŸ¤§","ğŸ˜‡","ğŸ¥³","ğŸ¥º","ğŸ¥²","ğŸ¤ ","ğŸ¥¸","ğŸ¤“",
    "ğŸ§","ğŸ« ","ğŸ¤–","ğŸ‘»","ğŸ’€","â˜ ï¸","ğŸ‘½","ğŸ‘¾","ğŸ‘¹","ğŸ‘º","ğŸ’©","ğŸ˜º","ğŸ˜¸","ğŸ˜¹","ğŸ˜»","ğŸ˜¼","ğŸ˜½",
    "ğŸ™€","ğŸ˜¿","ğŸ˜¾","ğŸ™ˆ","ğŸ™‰","ğŸ™Š",
    # å¤©æ°”ä¸è‡ªç„¶
    "ğŸŒ","ğŸŒ","ğŸŒš","ğŸŒ•","ğŸŒ–","ğŸŒ—","ğŸŒ˜","ğŸŒ‘","ğŸŒ’","ğŸŒ“","ğŸŒ”","ğŸŒ™","ğŸŒ","ğŸŒ","ğŸŒ","ğŸª","â­","ğŸŒŸ",
    "âœ¨","âš¡","â˜„ï¸","ğŸ’¥","ğŸ”¥","ğŸŒªï¸","ğŸŒˆ","â˜€ï¸","ğŸŒ¤ï¸","â›…","ğŸŒ¥ï¸","â˜ï¸","ğŸŒ¦ï¸","ğŸŒ§ï¸","â›ˆï¸","ğŸŒ©ï¸","ğŸŒ¨ï¸",
    "â„ï¸","â˜ƒï¸","â›„","ğŸŒ¬ï¸","ğŸ’¨","ğŸ’§","ğŸ’¦","â˜”","â˜‚ï¸","ğŸŒŠ","ğŸŒ«ï¸",
    # åŠ¨ç‰©ä¸è‡ªç„¶
    "ğŸ¶","ğŸ±","ğŸ­","ğŸ¹","ğŸ°","ğŸ¦Š","ğŸ»","ğŸ¼","ğŸ¨","ğŸ¯","ğŸ¦","ğŸ®","ğŸ·","ğŸ½","ğŸ¸","ğŸµ","ğŸ™ˆ","ğŸ™‰","ğŸ™Š",
    "ğŸ’","ğŸ”","ğŸ§","ğŸ¦","ğŸ¤","ğŸ£","ğŸ¥","ğŸ¦†","ğŸ¦…","ğŸ¦‰","ğŸ¦‡","ğŸº","ğŸ—","ğŸ´","ğŸ¦„","ğŸ","ğŸ›","ğŸ¦‹",
    "ğŸŒ","ğŸš","ğŸ","ğŸœ","ğŸ¦—","ğŸ•·ï¸","ğŸ¦‚","ğŸ¢","ğŸ","ğŸ¦","ğŸ¦–","ğŸ¦•","ğŸ™","ğŸ¦‘","ğŸ¦","ğŸ¦","ğŸ¦€","ğŸ¡",
    "ğŸ ","ğŸŸ","ğŸ¬","ğŸ³","ğŸ‹","ğŸ¦ˆ","ğŸŠ","ğŸ…","ğŸ†","ğŸ˜","ğŸ¦","ğŸ¦›","ğŸª","ğŸ«","ğŸ¦™","ğŸ¦’","ğŸƒ","ğŸ‚",
    "ğŸ„","ğŸ","ğŸ–","ğŸ","ğŸ‘","ğŸ","ğŸ¦Œ","ğŸ•","ğŸ©","ğŸ¦®","ğŸ•â€ğŸ¦º","ğŸˆ","ğŸ“","ğŸ¦ƒ","ğŸ¦š","ğŸ¦œ","ğŸ¦¢",
    "ğŸ¦©","ğŸ•Šï¸","ğŸ‡","ğŸ¦","ğŸ¦¨","ğŸ¦¡","ğŸ¦¦","ğŸ¦¥","ğŸ","ğŸ€","ğŸ¿ï¸","ğŸ¦”",
    # é£Ÿç‰©ä¸é¥®æ–™
    "ğŸ","ğŸ","ğŸ","ğŸŠ","ğŸ‹","ğŸŒ","ğŸ‰","ğŸ‡","ğŸ“","ğŸ«","ğŸˆ","ğŸ’","ğŸ‘","ğŸ¥­","ğŸ","ğŸ¥¥","ğŸ¥",
    "ğŸ…","ğŸ†","ğŸ¥‘","ğŸ¥¦","ğŸ¥¬","ğŸ¥’","ğŸŒ¶ï¸","ğŸ«‘","ğŸŒ½","ğŸ¥•","ğŸ«’","ğŸ§„","ğŸ§…","ğŸ¥”","ğŸ ","ğŸ¥","ğŸ¥¯",
    "ğŸ","ğŸ¥–","ğŸ¥¨","ğŸ§€","ğŸ¥š","ğŸ³","ğŸ¥","ğŸ§‡","ğŸ¥“","ğŸ¥©","ğŸ—","ğŸ–","ğŸ¦´","ğŸŒ­","ğŸ”","ğŸŸ","ğŸ•",
    "ğŸ¥ª","ğŸ¥™","ğŸ§†","ğŸŒ®","ğŸŒ¯","ğŸ«”","ğŸ¥—","ğŸ¥˜","ğŸ«•","ğŸ","ğŸœ","ğŸ²","ğŸ›","ğŸ£","ğŸ±","ğŸ¥Ÿ","ğŸ¦ª",
    "ğŸ¤","ğŸ™","ğŸš","ğŸ˜","ğŸ¥","ğŸ¥ ","ğŸ¥®","ğŸ¢","ğŸ¡","ğŸ§","ğŸ¨","ğŸ¦","ğŸ¥§","ğŸ§","ğŸ°","ğŸ‚","ğŸ®",
    "ğŸ­","ğŸ¬","ğŸ«","ğŸ¿","ğŸ©","ğŸª","ğŸ¥›","ğŸ¼","â˜•","ğŸ«–","ğŸµ","ğŸ§ƒ","ğŸ¥¤","ğŸ§‹","ğŸ¶","ğŸº","ğŸ»",
    "ğŸ¥‚","ğŸ·","ğŸ¥ƒ","ğŸ§‰","ğŸ¸","ğŸ¹","ğŸ§Š","ğŸ¥„","ğŸ´","ğŸ½ï¸","ğŸ¥£","ğŸ¥¡","ğŸ¥¢","ğŸ§‚",
    # æ´»åŠ¨
    "âš½","ğŸ€","ğŸˆ","âš¾","ğŸ¥","ğŸ¾","ğŸ","ğŸ‰","ğŸ¥","ğŸ±","ğŸª€","ğŸ“","ğŸ¸","ğŸ’","ğŸ‘","ğŸ¥","ğŸ",
    "ğŸªƒ","ğŸ¥…","â›³","ğŸª","ğŸ¹","ğŸ£","ğŸ¤¿","ğŸ¥Š","ğŸ¥‹","ğŸ½","ğŸ›¹","ğŸ›·","â›¸ï¸","ğŸ¥Œ","ğŸ›¶","â›µ","ğŸš¤",
    "ğŸ›¥ï¸","ğŸ›³ï¸","â›´ï¸","ğŸš¢","âœˆï¸","ğŸ›©ï¸","ğŸš","ğŸšŸ","ğŸš ","ğŸš¡","ğŸš€","ğŸ›¸",
    # ç‰©å“
    "âŒš","ğŸ“±","ğŸ“²","ğŸ’»","âŒ¨ï¸","ğŸ–¥ï¸","ğŸ–¨ï¸","ğŸ–±ï¸","ğŸ–²ï¸","ğŸ•¹ï¸","ğŸ—œï¸","ğŸ’½","ğŸ’¾","ğŸ’¿","ğŸ“€","ğŸ“¼",
    "ğŸ“·","ğŸ“¸","ğŸ“¹","ğŸ¥","ğŸ“½ï¸","ğŸï¸","ğŸ“","â˜ï¸","ğŸ“Ÿ","ğŸ“ ","ğŸ“º","ğŸ“»","ğŸ™ï¸","ğŸšï¸","ğŸ›ï¸","â±ï¸",
    "â²ï¸","â°","ğŸ•°ï¸","âŒ›","â³","ğŸ“¡","ğŸ”‹","ğŸ”Œ","ğŸ’¡","ğŸ”¦","ğŸ•¯ï¸","ğŸ§¯","ğŸ›¢ï¸","ğŸ’¸","ğŸ’µ","ğŸ’´",
    "ğŸ’¶","ğŸ’·","ğŸª™","ğŸ’°","ğŸ’³","ğŸ§¾","ğŸ’","âš–ï¸","ğŸªœ","ğŸ§°","ğŸª›","ğŸ”§","ğŸ”¨","âš’ï¸","ğŸ› ï¸","â›ï¸",
    "ğŸ”©","âš™ï¸","ğŸ—œï¸","âš—ï¸","ğŸ§ª","ğŸ§«","ğŸ§¬","ğŸ”¬","ğŸ”­","ğŸ“¡","ğŸ’‰","ğŸ’Š","ğŸ©¹","ğŸ©º","ğŸšª","ğŸ›ï¸",
    "ğŸ›‹ï¸","ğŸª‘","ğŸš½","ğŸš¿","ğŸ›","ğŸª","ğŸªŸ","ğŸ§´","ğŸ§·","ğŸ§¹","ğŸ§º","ğŸ§»","ğŸª ","ğŸš¬","âš°ï¸","ğŸª¦","âš±ï¸",
    "ğŸ—¿","ğŸª§","ğŸªª",
    # äº¤é€š
    "ğŸš—","ğŸš•","ğŸš™","ğŸšŒ","ğŸš","ğŸï¸","ğŸš“","ğŸš‘","ğŸš’","ğŸš","ğŸ›»","ğŸšš","ğŸš›","ğŸšœ","ğŸ¦½","ğŸ¦¼","ğŸ›´",
    "ğŸš²","ğŸ›µ","ğŸï¸","ğŸ›º","ğŸš¨","ğŸš”","ğŸš","ğŸš˜","ğŸš–","ğŸš¡","ğŸš ","ğŸšŸ","ğŸšƒ","ğŸš‹","ğŸš","ğŸš","ğŸš„",
    "ğŸš…","ğŸšˆ","ğŸš‚","ğŸš†","ğŸš‡","ğŸšŠ","ğŸš‰","âœˆï¸","ğŸ›«","ğŸ›¬","ğŸ›©ï¸","ğŸ’º","ğŸ›°ï¸","ğŸš€","ğŸ›¸","ğŸš","ğŸ›¶",
    # æ——å¸œï¼ˆå–éƒ¨åˆ†å¸¸ç”¨çš„ï¼Œå®‰å“å…¨é¢æ”¯æŒï¼‰
    "ğŸ³ï¸","ğŸ´","ğŸ","ğŸš©","ğŸ³ï¸â€ğŸŒˆ","ğŸ³ï¸â€âš§ï¸","ğŸ‡¨ğŸ‡³","ğŸ‡ºğŸ‡¸","ğŸ‡¬ğŸ‡§","ğŸ‡«ğŸ‡·","ğŸ‡¯ğŸ‡µ","ğŸ‡°ğŸ‡·","ğŸ‡©ğŸ‡ª","ğŸ‡·ğŸ‡º",
    "ğŸ‡®ğŸ‡³","ğŸ‡®ğŸ‡©","ğŸ‡§ğŸ‡·","ğŸ‡¦ğŸ‡º","ğŸ‡¨ğŸ‡¦","ğŸ‡¸ğŸ‡¬","ğŸ‡¹ğŸ‡¼","ğŸ‡­ğŸ‡°","ğŸ‡¹ğŸ‡­","ğŸ‡®ğŸ‡¹","ğŸ‡ªğŸ‡¸","ğŸ‡²ğŸ‡½","ğŸ‡¸ğŸ‡ª","ğŸ‡³ğŸ‡±",
    "ğŸ‡¹ğŸ‡·","ğŸ‡¸ğŸ‡¦","ğŸ‡¦ğŸ‡ª","ğŸ‡¨ğŸ‡­","ğŸ‡³ğŸ‡¿","ğŸ‡²ğŸ‡¾","ğŸ‡³ğŸ‡´","ğŸ‡©ğŸ‡°","ğŸ‡«ğŸ‡®","ğŸ‡µğŸ‡¹","ğŸ‡µğŸ‡±","ğŸ‡§ğŸ‡ª","ğŸ‡¦ğŸ‡·","ğŸ‡¿ğŸ‡¦",
    "ğŸ‡ªğŸ‡¬"
]

EMOJI_PATTERN = re.compile(
    "["  # åŒ¹é…ç»å¤§éƒ¨åˆ†å®‰å“æ”¯æŒçš„ emoji
    "\U0001F600-\U0001F64F"
    "\U0001F300-\U0001F5FF"
    "\U0001F680-\U0001F6FF"
    "\U0001F1E0-\U0001F1FF"
    "\U00002700-\U000027BF"
    "\U0001F900-\U0001F9FF"
    "\U00002600-\U000026FF"
    "\U0001F700-\U0001F77F"
    "\U0001FA70-\U0001FAFF"
    "\U0001F780-\U0001F7FF"
    "\U0001F800-\U0001F8FF"
    "\U0001FA00-\U0001FA6F"
    "]+", flags=re.UNICODE
)

def get_unique_emoji(used_emojis):
    """
    è·å–ä¸€ä¸ªå…¨å±€å”¯ä¸€æœªç”¨è¿‡çš„emojiã€‚å¦‚æœemojiç”¨å°½ï¼Œåˆ™å…è®¸é‡å¤ã€‚
    """
    available = list(set(ALL_EMOJIS) - used_emojis)
    if not available:
        # å·²ç»ç”¨å®Œå…¨éƒ¨emojiï¼Œåˆ™å…è®¸é‡å¤
        available = ALL_EMOJIS
    emoji = random.choice(available)
    used_emojis.add(emoji)
    return emoji

def replace_emojis_preserve_text(line, used_emojis):
    """
    åªæ›¿æ¢lineä¸­çš„emojiå­—ç¬¦ï¼ˆæ¯ä¸ªemojiä¸é‡å¤ï¼‰ï¼Œå…¶ä»–å†…å®¹ä¸€å¾‹ä¸å˜ã€‚
    """
    def emoji_replacer(match):
        return get_unique_emoji(used_emojis)
    # ä»…æ›¿æ¢emojiå­—ç¬¦ï¼Œå…¶ä»–å†…å®¹å’Œæ ¼å¼å®Œå…¨ä¸åŠ¨
    return EMOJI_PATTERN.sub(emoji_replacer, line)

def process_txt_file(input_path, output_path):
    try:
        with open(input_path, 'r', encoding='utf-8') as f:
            lines = f.readlines()
    except Exception as e:
        print(f"è¯»å–æ–‡ä»¶å¤±è´¥: {input_path}, é”™è¯¯: {e}")
        return
    used_emojis = set()
    processed_lines = []
    for line in lines:
        # ä¿æŒæ¯è¡Œç»“å°¾æ ¼å¼
        original_line = line
        replaced_line = replace_emojis_preserve_text(original_line.rstrip('\n'), used_emojis)
        # ä¿ç•™åŸæœ‰çš„æ¢è¡Œç¬¦
        if original_line.endswith('\n'):
            replaced_line += '\n'
        processed_lines.append(replaced_line)
    # å†™å…¥ä¸ºjsonæ•°ç»„ï¼Œæ¯é¡¹ä¸ºä¸€è¡Œï¼ˆå«æ¢è¡Œç¬¦ï¼‰ï¼Œä¿è¯è¿˜åŸåŸæ–‡ä»¶æ ¼å¼
    try:
        with open(output_path, 'w', encoding='utf-8') as f:
            json.dump(processed_lines, f, ensure_ascii=False, indent=2)
        print(f"å·²ç”Ÿæˆæ–‡ä»¶: {output_path}")
    except Exception as e:
        print(f"å†™å…¥æ–‡ä»¶å¤±è´¥: {output_path}, é”™è¯¯: {e}")

def main():
    script_dir = os.path.dirname(os.path.abspath(__file__))
    emojis_dir = script_dir
    output_dir = os.path.join(emojis_dir, "output")
    os.makedirs(output_dir, exist_ok=True)
    for file in os.listdir(emojis_dir):
        if file.endswith('.txt'):
            input_path = os.path.join(emojis_dir, file)
            out_name = os.path.splitext(file)[0] + ".json"
            output_path = os.path.join(output_dir, out_name)
            process_txt_file(input_path, output_path)

if __name__ == "__main__":
    main()
