import os
import json
import random
import re

# å®Œæ•´ä¸”å®‰å“ç³»ç»Ÿæ”¯æŒçš„ Emoji åˆ—è¡¨ï¼ˆUnicode 13.0+ï¼Œå¸¸è§è¡¨æƒ…å…¨è¦†ç›–ï¼ŒåŒ…å«è¡¨æƒ…ã€åŠ¨ç‰©ã€é£Ÿç‰©ã€ç‰©å“ã€æ——å¸œç­‰ï¼‰
ALL_EMOJIS = [
    # è¡¨æƒ…ç¬¦å·
    "ğŸ˜€","ğŸ˜","ğŸ˜‚","ğŸ¤£","ğŸ˜ƒ","ğŸ˜„","ğŸ˜…","ğŸ˜†","ğŸ˜‰","ğŸ˜Š","ğŸ˜‹","ğŸ˜","ğŸ˜","ğŸ˜˜","ğŸ¥°","ğŸ˜—","ğŸ˜™","ğŸ˜š",
    "ğŸ™‚","ğŸ¤—","ğŸ¤©","ğŸ¤”","ğŸ¤¨","ğŸ˜","ğŸ˜‘","ğŸ˜¶","ğŸ™„","ğŸ˜","ğŸ˜£","ğŸ˜¥","ğŸ˜®","ğŸ¤","ğŸ˜¯","ğŸ˜ª","ğŸ˜«",
    "ğŸ¥±","ğŸ˜´","ğŸ˜Œ","ğŸ˜›","ğŸ˜œ","ğŸ˜","ğŸ¤¤","ğŸ˜’","ğŸ˜“","ğŸ˜”","ğŸ˜•","ğŸ™ƒ","ğŸ¤‘","ğŸ˜²","â˜¹ï¸","ğŸ™","ğŸ˜–",
    "ğŸ˜","ğŸ˜Ÿ","ğŸ˜¤","ğŸ˜¢","ğŸ˜­","ğŸ˜¦","ğŸ˜§","ğŸ˜¨","ğŸ˜©","ğŸ¤¯","ğŸ˜¬","ğŸ˜°","ğŸ˜±","ğŸ¥µ","ğŸ¥¶","ğŸ˜³","ğŸ¤ª",
    "ğŸ˜µ","ğŸ˜¡","ğŸ˜ ","ğŸ¤¬","ğŸ˜·","ğŸ¤’","ğŸ¤•","ğŸ¤¢","ğŸ¤®","ğŸ¤§","ğŸ˜‡","ğŸ¥³","ğŸ¥º","ğŸ¥²","ğŸ¤ ","ğŸ¥¸","ğŸ¤“",
    "ğŸ§","ğŸ« ","ğŸ¤–","ğŸ‘»","ğŸ’€","â˜ ï¸","ğŸ‘½","ğŸ‘¾","ğŸ‘¹","ğŸ‘º","ğŸ’©","ğŸ˜º","ğŸ˜¸","ğŸ˜¹","ğŸ˜»","ğŸ˜¼","ğŸ˜½",
    "ğŸ™€","ğŸ˜¿","ğŸ˜¾","ğŸ™ˆ","ğŸ™‰","ğŸ™Š",
    # å¤©æ°”ä¸è‡ªç„¶
    "ğŸŒ","ğŸŒ","ğŸŒš","ğŸŒ•","ğŸŒ–","ğŸŒ—","ğŸŒ˜","ğŸŒ‘","ğŸŒ’","ğŸŒ“","ğŸŒ”","ğŸŒ™","ğŸŒ","ğŸŒ","ğŸŒ","ğŸª","â­","ğŸŒŸ",
    "âœ¨","âš¡","â˜„ï¸","ğŸ’¥","ğŸ”¥","ğŸŒªï¸","ğŸŒˆ","â˜€ï¸","ğŸŒ¤ï¸","â›…","ğŸŒ¥ï¸","â˜ï¸","ğŸŒ¦ï¸","ğŸŒ§ï¸","â›ˆï¸","ğŸŒ©ï¸","ğŸŒ¨ï¸",
    "â„ï¸","â˜ƒï¸","â›„","ğŸŒ¬ï¸","ğŸ’¨","ğŸ’§","ğŸ’¦","â˜”","â˜‚ï¸","ğŸŒŠ","ğŸŒ«ï¸",
    # åŠ¨ç‰©ä¸è‡ªç„¶
    "ğŸ¶","ğŸ±","ğŸ­","ğŸ¹","ğŸ°","ğŸ¦Š","ğŸ»","ğŸ¼","ğŸ¨","ğŸ¯","ğŸ¦","ğŸ®","ğŸ·","ğŸ½","ğŸ¸","ğŸµ","ğŸ™ˆ","ğŸ™‰","ğŸ™Š",
    "ğŸ’","ğŸ”","ğŸ§","ğŸ¦","ğŸ¤","ğŸ£","ğŸ¥","ğŸ¦†","ğŸ¦…","ğŸ¦‰","ğŸ¦‡","ğŸº","ğŸ—","ğŸ´","ğŸ¦„","ğŸ","ğŸ›","ğŸ¦‹",
    "ğŸŒ","ğŸš","ğŸ","ğŸœ","ğŸ¦—","ğŸ•·ï¸","ğŸ¦‚","ğŸ¢","ğŸ","ğŸ¦","ğŸ¦–","ğŸ¦•","ğŸ™","ğŸ¦‘","ğŸ¦","ğŸ¦","ğŸ¦€","ğŸ¡",
    "ğŸ ","ğŸŸ","ğŸ¬","ğŸ³","ğŸ‹","ğŸ¦ˆ","ğŸŠ","ğŸ…","ğŸ†","ğŸ˜","ğŸ¦","ğŸ¦›","ğŸª","ğŸ«","ğŸ¦™","ğŸ¦’","ğŸƒ","ğŸ‚",
    "ğŸ„","ğŸ","ğŸ–","ğŸ","ğŸ‘","ğŸ","ğŸ¦Œ","ğŸ•","ğŸ©","ğŸ¦®","ğŸ•â€ğŸ¦º","ğŸˆ","ğŸ“","ğŸ¦ƒ","ğŸ¦š","ğŸ¦œ","ğŸ¦¢",
    "ğŸ¦©","ğŸ•Šï¸","ğŸ‡","ğŸ¦","ğŸ¦¨","ğŸ¦¡","ğŸ¦¦","ğŸ¦¥","ğŸ","ğŸ€","ğŸ¿ï¸","ğŸ¦”",
    # é£Ÿç‰©ä¸é¥®æ–™
    "ğŸ","ğŸ","ğŸ","ğŸŠ","ğŸ‹","ğŸŒ","ğŸ‰","ğŸ‡","ğŸ“","ğŸ«","ğŸˆ","ğŸ’","ğŸ‘","ğŸ¥­","ğŸ","ğŸ¥¥","ğŸ¥",
    "ğŸ…","ğŸ†","ğŸ¥‘","ğŸ¥¦","ğŸ¥¬","ğŸ¥’","ğŸŒ¶ï¸","ğŸ«‘","ğŸŒ½","ğŸ¥•","ğŸ«’","ğŸ§„","ğŸ§…","ğŸ¥”","ğŸ ","ğŸ¥","ğŸ¥¯",
    "ğŸ","ğŸ¥–","ğŸ¥¨","ğŸ§€","ğŸ¥š","ğŸ³","ğŸ¥","ğŸ§‡","ğŸ¥“","ğŸ¥©","ğŸ—","ğŸ–","ğŸ¦´","ğŸŒ­","ğŸ”","ğŸŸ","ğŸ•",
    "ğŸ¥ª","ğŸ¥™","ğŸ§†","ğŸŒ®","ğŸŒ¯","ğŸ«”","ğŸ¥—","ğŸ¥˜","ğŸ«•","ğŸ","ğŸœ","ğŸ²","ğŸ›","ğŸ£","ğŸ±","ğŸ¥Ÿ","ğŸ¦ª",
    "ğŸ¤","ğŸ™","ğŸš","ğŸ˜","ğŸ¥","ğŸ¥ ","ğŸ¥®","ğŸ¢","ğŸ¡","ğŸ§","ğŸ¨","ğŸ¦","ğŸ¥§","ğŸ§","ğŸ°","ğŸ‚","ğŸ®",
    "ğŸ­","ğŸ¬","ğŸ«","ğŸ¿","ğŸ©","ğŸª","ğŸ¥›","ğŸ¼","â˜•","ğŸ«–","ğŸµ","ğŸ§ƒ","ğŸ¥¤","ğŸ§‹","ğŸ¶","ğŸº","ğŸ»",
    "ğŸ¥‚","ğŸ·","ğŸ¥ƒ","ğŸ§‰","ğŸ¸","ğŸ¹","ğŸ§Š","ğŸ¥„","ğŸ´","ğŸ½ï¸","ğŸ¥£","ğŸ¥¡","ğŸ¥¢","ğŸ§‚",
    # æ´»åŠ¨
    "âš½","ğŸ€","ğŸˆ","âš¾","ğŸ¥","ğŸ¾","ğŸ","ğŸ‰","ğŸ¥","ğŸ±","ğŸª€","ğŸ“","ğŸ¸","ğŸ’","ğŸ‘","ğŸ¥","ğŸ",
    "ğŸªƒ","ğŸ¥…","â›³","ğŸª","ğŸ¹","ğŸ£","ğŸ¤¿","ğŸ¥Š","ğŸ¥‹","ğŸ½","ğŸ›¹","ğŸ›·","â›¸ï¸","ğŸ¥Œ","ğŸ›¶","â›µ","ğŸš¤",
    "ğŸ›¥ï¸","ğŸ›³ï¸","â›´ï¸","ğŸš¢","âœˆï¸","ğŸ›©ï¸","ğŸš","ğŸšŸ","ğŸš ","ğŸš¡","ğŸš€","ğŸ›¸",
    # ç‰©å“
    "âŒš","ğŸ“±","ğŸ“²","ğŸ’»","âŒ¨ï¸","ğŸ–¥ï¸","ğŸ–¨ï¸","ğŸ–±ï¸","ğŸ–²ï¸","ğŸ•¹ï¸","ğŸ—œï¸","ğŸ’½","ğŸ’¾","ğŸ’¿","ğŸ“€","ğŸ“¼",
    "ğŸ“·","ğŸ“¸","ğŸ“¹","ğŸ¥","ğŸ“½ï¸","ğŸï¸","ğŸ“","â˜ï¸","ğŸ“Ÿ","ğŸ“ ","ğŸ“º","ğŸ“»","ğŸ™ï¸","ğŸšï¸","ğŸ›ï¸","â±ï¸",
    "â²ï¸","â°","ğŸ•°ï¸","âŒ›","â³","ğŸ“¡","ğŸ”‹","ğŸ”Œ","ğŸ’¡","ğŸ”¦","ğŸ•¯ï¸","ğŸ§¯","ğŸ›¢ï¸","ğŸ’¸","ğŸ’µ","ğŸ’´",
    "ğŸ’¶","ğŸ’·","ğŸª™","ğŸ’°","ğŸ’³","ğŸ§¾","ğŸ’","âš–ï¸","ğŸªœ","ğŸ§°","ğŸª›","ğŸ”§","ğŸ”¨","âš’ï¸","ğŸ› ï¸","â›ï¸",
    "ğŸ”©","âš™ï¸","ğŸ—œï¸","âš—ï¸","ğŸ§ª","ğŸ§«","ğŸ§¬","ğŸ”¬","ğŸ”­","ğŸ“¡","ğŸ’‰","ğŸ’Š","ğŸ©¹","ğŸ©º","ğŸšª","ğŸ›ï¸",
    "ğŸ›‹ï¸","ğŸª‘","ğŸš½","ğŸš¿","ğŸ›","ğŸª","ğŸªŸ","ğŸ§´","ğŸ§·","ğŸ§¹","ğŸ§º","ğŸ§»","ğŸª ","ğŸš¬","âš°ï¸","ğŸª¦","âš±ï¸",
    "ğŸ—¿","ğŸª§","ğŸªª",
    # äº¤é€š
    "ğŸš—","ğŸš•","ğŸš™","ğŸšŒ","ğŸš","ğŸï¸","ğŸš“","ğŸš‘","ğŸš’","ğŸš","ğŸ›»","ğŸšš","ğŸš›","ğŸšœ","ğŸ¦½","ğŸ¦¼","ğŸ›´",
    "ğŸš²","ğŸ›µ","ğŸï¸","ğŸ›º","ğŸš¨","ğŸš”","ğŸš","ğŸš˜","ğŸš–","ğŸš¡","ğŸš ","ğŸšŸ","ğŸšƒ","ğŸš‹","ğŸš","ğŸš","ğŸš„",
    "ğŸš…","ğŸšˆ","ğŸš‚","ğŸš†","ğŸš‡","ğŸšŠ","ğŸš‰","âœˆï¸","ğŸ›«","ğŸ›¬","ğŸ›©ï¸","ğŸ’º","ğŸ›°ï¸","ğŸš€","ğŸ›¸","ğŸš","ğŸ›¶",
    # æ——å¸œï¼ˆå–éƒ¨åˆ†å¸¸ç”¨çš„ï¼Œå®‰å“å…¨é¢æ”¯æŒï¼‰
    "ğŸ³ï¸","ğŸ´","ğŸ","ğŸš©","ğŸ³ï¸â€ğŸŒˆ","ğŸ³ï¸â€âš§ï¸","ğŸ‡¨ğŸ‡³","ğŸ‡ºğŸ‡¸","ğŸ‡¬ğŸ‡§","ğŸ‡«ğŸ‡·","ğŸ‡¯ğŸ‡µ","ğŸ‡°ğŸ‡·","ğŸ‡©ğŸ‡ª","ğŸ‡·ğŸ‡º",
    "ğŸ‡®ğŸ‡³","ğŸ‡®ğŸ‡©","ğŸ‡§ğŸ‡·","ğŸ‡¦ğŸ‡º","ğŸ‡¨ğŸ‡¦","ğŸ‡¸ğŸ‡¬","ğŸ‡¹ğŸ‡¼","ğŸ‡­ğŸ‡°","ğŸ‡¹ğŸ‡­","ğŸ‡®ğŸ‡¹","ğŸ‡ªğŸ‡¸","ğŸ‡²ğŸ‡½","ğŸ‡¸ğŸ‡ª","ğŸ‡³ğŸ‡±",
    "ğŸ‡¹ğŸ‡·","ğŸ‡¸ğŸ‡¦","ğŸ‡¦ğŸ‡ª","ğŸ‡¨ğŸ‡­","ğŸ‡³ğŸ‡¿","ğŸ‡²ğŸ‡¾","ğŸ‡³ğŸ‡´","ğŸ‡©ğŸ‡°","ğŸ‡«ğŸ‡®","ğŸ‡µğŸ‡¹","ğŸ‡µğŸ‡±","ğŸ‡§ğŸ‡ª","ğŸ‡¦ğŸ‡·","ğŸ‡¿ğŸ‡¦",
    "ğŸ‡ªğŸ‡¬"
]

# Emojiæ­£åˆ™è¡¨è¾¾å¼ï¼Œè¦†ç›–å¸¸è§å®‰å“æ”¯æŒåŒºé—´
EMOJI_PATTERN = re.compile(
    "["  # å„ä¸»æµAndroidç³»ç»Ÿæ”¯æŒçš„emojiåŒºæ®µ
    "\U0001F600-\U0001F64F"  # è¡¨æƒ…
    "\U0001F300-\U0001F5FF"  # ç¬¦å·å’Œè±¡å½¢æ–‡å­—
    "\U0001F680-\U0001F6FF"  # äº¤é€šå·¥å…·
    "\U0001F1E0-\U0001F1FF"  # æ——å¸œ
    "\U00002700-\U000027BF"  # Dingbats
    "\U0001F900-\U0001F9FF"  # è¡¥å……è¡¨æƒ…
    "\U00002600-\U000026FF"  # æ‚é¡¹ç¬¦å·
    "\U0001F700-\U0001F77F"  # ç‚¼é‡‘æœ¯ç¬¦å·
    "\U0001FA70-\U0001FAFF"  # è¡¥å……è±¡å½¢æ–‡å­—
    "\U0001F780-\U0001F7FF"  # å‡ ä½•æ‰©å±•
    "\U0001F800-\U0001F8FF"  # è¡¥å……ç®­å¤´
    "\U0001FA00-\U0001FA6F"  # å›½é™…è±¡æ£‹ç¬¦å·
    "]+", flags=re.UNICODE
)

def replace_emojis_in_str_unique(s, used_emojis):
    """
    å°†å­—ç¬¦ä¸²ä¸­æ¯ä¸ª emoji æ›¿æ¢ä¸ºåœ¨æœ¬è¡Œæœªå‡ºç°è¿‡ä¸”å…¨å±€æœªå‡ºç°è¿‡çš„éšæœºæ–° emojiï¼ˆä¸ä¼šé‡å¤ï¼‰ã€‚
    è‹¥emojiå·²ç”¨å°½åˆ™å…è®¸é‡å¤ã€‚
    """
    unique_emojis_line = set()
    # æ‰¾åˆ°åŸå§‹è¡Œä¸­æœ‰å¤šå°‘ä¸ªemojiè¦æ›¿æ¢
    matches = list(EMOJI_PATTERN.finditer(s))
    result = []
    last_idx = 0
    for match in matches:
        start, end = match.start(), match.end()
        result.append(s[last_idx:start])
        # é€‰æ‹©æœªåœ¨æœ¬è¡Œã€æœªå…¨å±€ç”¨è¿‡çš„emoji
        available = list(set(ALL_EMOJIS) - unique_emojis_line - used_emojis)
        if not available:
            # å¦‚æœå…¨éƒ¨emojiå·²ç”¨å®Œï¼Œå…è®¸æœ¬è¡Œä¸é‡å¤
            available = list(set(ALL_EMOJIS) - unique_emojis_line)
        if not available:
            # å¦‚æœæœ¬è¡Œä¹Ÿç”¨å®Œï¼Œå®Œå…¨éšæœº
            available = ALL_EMOJIS
        emoji = random.choice(available)
        result.append(emoji)
        unique_emojis_line.add(emoji)
        used_emojis.add(emoji)
        last_idx = end
    result.append(s[last_idx:])
    return ''.join(result)

def process_txt_file(input_path, output_path):
    try:
        with open(input_path, 'r', encoding='utf-8') as f:
            lines = f.readlines()
    except Exception as e:
        print(f"è¯»å–æ–‡ä»¶å¤±è´¥: {input_path}, é”™è¯¯: {e}")
        return
    used_emojis_global = set()
    processed_lines = []
    for line in lines:
        line = line.rstrip('\n')
        replaced_line = replace_emojis_in_str_unique(line, used_emojis_global)
        processed_lines.append(replaced_line)
    try:
        with open(output_path, 'w', encoding='utf-8') as f:
            json.dump(processed_lines, f, ensure_ascii=False, indent=2)
        print(f"å·²ç”Ÿæˆæ–‡ä»¶: {output_path}")
    except Exception as e:
        print(f"å†™å…¥æ–‡ä»¶å¤±è´¥: {output_path}, é”™è¯¯: {e}")

def main():
    script_dir = os.path.dirname(os.path.abspath(__file__))
    emojis_dir = script_dir
    output_dir = os.path.join(emojis_dir, "output")
    os.makedirs(output_dir, exist_ok=True)

    for file in os.listdir(emojis_dir):
        if file.endswith('.txt'):
            input_path = os.path.join(emojis_dir, file)
            out_name = os.path.splitext(file)[0] + ".json"
            output_path = os.path.join(output_dir, out_name)
            process_txt_file(input_path, output_path)

if __name__ == "__main__":
    main()
