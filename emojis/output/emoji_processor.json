{
  "original_file": "/home/runner/work/X/X/emojis/emoji_processor.py",
  "content": "import os\nimport re\nimport json\nfrom pathlib import Path\nfrom typing import Dict, List, Union, Any\n\n# Emoji è¡¨æƒ…é›†åˆï¼ŒåŒ…å«åŠ¨ç‰©ä¸è‡ªç„¶ã€é£Ÿç‰©ä¸é¥®æ–™ã€æ´»åŠ¨ã€ç‰©ä½“ã€æ—…è¡Œä¸åœ°ç‚¹ç­‰ç±»åˆ«\nEMOJI_POOL = [\n    # åŠ¨ç‰©ä¸è‡ªç„¶\n    'ğŸŒ', 'ğŸš‰', 'ğŸŒ¸', 'ğŸ¥', 'ğŸ†', 'ğŸ»', 'ğŸ¤', 'ğŸšŒ', 'ğŸ¬', 'ğŸ› ï¸', \n    'â­', 'ğŸš…', 'ğŸš', 'âš¾', 'ğŸ§', 'ğŸ‰', 'ğŸ¥˜', 'ğŸš', 'ğŸ¸', 'ğŸ»', \n    'ğŸš', 'ğŸ', 'ğŸ“ ', 'ğŸ§', 'ğŸŠ', 'ğŸ…', 'ğŸŒ¶ï¸', 'ğŸ°', 'ğŸ¢', 'ğŸš', \n    'â›·ï¸', 'ğŸ¿', 'ğŸ¥', 'ğŸ”¥', 'ğŸŒ™', 'ğŸŒ½', 'ğŸ¼', 'ğŸ’¿', 'ğŸ¼', 'ğŸ', \n    'â˜€ï¸', 'â­', 'âœ¨', 'ğŸ–', 'â˜ï¸', 'ğŸ”¨ï¸', 'â›…', 'â„ï¸', 'â„ï¸', 'ğŸ¹',\n    \n    # é£Ÿç‰©ä¸é¥®æ–™\n    'ğŸ¤', 'ğŸ¿', 'ğŸ²', 'âŒ¨ï¸', 'â›³', 'ğŸ£', 'ğŸ¥—', 'ğŸ†', 'ğŸ”¦', 'ğŸš€', \n    'ğŸ§€', 'ğŸŒ ', 'ğŸ“½ï¸', 'ğŸ­', 'ğŸŒ¹', 'ğŸ±', 'ğŸ¦ï¸', 'ğŸ”¬', 'ğŸŒ±', 'ğŸš½', \n    'ğŸŸ', 'ğŸ’¡', 'ğŸ”', 'ğŸ‡', 'ğŸŒº', 'ğŸš‡', 'ğŸ­', 'ğŸ—', 'ğŸ“½ï¸', 'ğŸ•¹ï¸', \n    'ğŸŒ¯', 'ğŸ’', 'ğŸŒ›', 'ğŸ§°', 'ğŸ¨', 'ğŸ€', 'ğŸŒ—', 'ğŸŒ²', 'ğŸ¦', 'ğŸ¥‡', \n    'â›…', 'ğŸš†', 'ğŸŒ', 'ğŸŒ•', 'ğŸœ', 'ğŸ’»', 'ğŸ•¹ï¸', 'â˜€ï¸', 'ğŸ‰', 'ğŸ',\n    \n    # æ´»åŠ¨\n    'âš½', 'ğŸ­', 'ğŸ¥©', 'âš¾', 'ğŸ¥”', 'ğŸ¾', 'ğŸ¦', 'ğŸš‚', 'ğŸ“', 'ğŸ“€', \n    'â›³', 'ğŸ“ï¸', 'ğŸ¨', 'ğŸ®', 'ğŸ¥', 'â›·ï¸', 'ğŸ“¼', 'ğŸŒ', 'ğŸŒ»ï¸', 'ğŸ¨', \n    'ğŸƒ', 'ğŸ±', 'ğŸ¥•', 'ğŸ›', 'ğŸ“½ï¸', 'ğŸ¹', 'âš’ï¸', 'ğŸ´', 'ğŸ§ï¸', 'ğŸŒ³', \n    'ğŸ²', 'ğŸ¥„', 'ğŸ¾', 'ğŸŒ´', 'ğŸ ', 'ğŸŠ', 'ğŸ–¥ï¸', 'ğŸ±', 'ğŸŒš', 'ğŸ', \n    'ğŸŒ˜', 'ğŸ€', 'âš½', 'ğŸ­', 'ğŸ¥©', 'âš¾', 'ğŸ¥”', 'ğŸ¾', 'ğŸ¦', 'ğŸš‚',\n    \n    # ç‰©ä½“\n    'ğŸ®', 'ğŸ“', 'ğŸ¯', 'ğŸ³', 'ğŸ¸', 'âŒ¨ï¸', 'ğŸ”Œï¸', 'ğŸ…ï¸', 'ğŸŒ»ï¸', 'ğŸŒ', \n    'ğŸ–¨ï¸', 'â˜ï¸', 'ğŸ', 'ğŸ¸', 'ğŸ‰', 'ğŸ“¸', 'ğŸ¼', 'ğŸ‡', 'ğŸ§ï¸', 'ğŸ±', \n    'ğŸˆ', 'âš½', 'ğŸ‘', 'ğŸŒµ', 'ğŸª‘', 'ğŸï¸', 'ğŸŒ§ï¸', 'âš½', 'ğŸ·', 'ğŸ¥­', \n    'ğŸ®', 'âš’ï¸', 'ğŸ’¦ï¸', 'ğŸª', 'ğŸŒ–', 'ğŸ”©', 'ğŸ”­', 'ğŸª‘', 'ğŸ”§', 'ğŸ›‹ï¸', \n    'ğŸ', 'ğŸ”ª', 'ğŸ“½ï¸', 'ğŸ¹', 'âš’ï¸', 'ğŸ´', 'ğŸ§ï¸', 'ğŸŒ³', 'ğŸ²', 'ğŸ¥„',\n    \n    # æ—…è¡Œä¸åœ°ç‚¹\n    'âœˆï¸', 'ğŸ¥ˆ', 'ğŸˆ', 'â›µ', 'ğŸ¥', 'ğŸ“·', 'ğŸ¥–', 'ğŸŒï¸', 'ğŸ£', 'ğŸ¥‰', \n    'âœ¨', 'ğŸ¬', 'ğŸ”‹', 'ğŸƒ', 'ğŸ³', 'ğŸ”', 'ğŸ¦Š', 'ğŸ¥', 'ğŸ¶', 'ğŸ’½', \n    'ğŸ”', 'âš¾', 'ğŸµ', 'ğŸ¥“', 'ğŸ¤', 'ğŸŒ¼', 'ğŸšŠï¸', 'ğŸŒï¸', 'ğŸ¡ï¸', 'ğŸš', \n    'ğŸ”', 'ğŸš´', 'ğŸ‹', 'ğŸ¥®', 'ğŸ™', 'ğŸ“±', 'ğŸˆ', 'ğŸ¤', 'ğŸš¢', 'ğŸšª', \n    'ğŸ˜ï¸', 'ğŸª', 'â›µ', 'âœˆï¸', 'ğŸ’¾', 'ğŸš¿', 'ğŸ·ï¸', 'ğŸ“Ÿ', 'ğŸšµ', 'ğŸ¯'\n]\n\n# Emoji æ­£åˆ™è¡¨è¾¾å¼æ¨¡å¼ï¼ŒåŒ¹é…å¸¸è§Emojiå­—ç¬¦\nEMOJI_REGEX = re.compile(\n    r'[\\U0001F300-\\U0001F64F\\U0001F680-\\U0001F6FF\\U0001F900-\\U0001F9FF\\U0001F1E0-\\U0001F1FF]'\n)\n\nclass EmojiManager:\n    \"\"\"Emojiè¡¨æƒ…ç®¡ç†ç±»ï¼Œè´Ÿè´£Emojiçš„æ›¿æ¢å’Œå¾ªç¯ä½¿ç”¨\"\"\"\n    \n    def __init__(self):\n        \"\"\"åˆå§‹åŒ–Emojiç®¡ç†å™¨\"\"\"\n        self.emoji_pool = EMOJI_POOL\n        self.emoji_index = 0\n    \n    def get_next_emoji(self) -> str:\n        \"\"\"è·å–ä¸‹ä¸€ä¸ªEmojiï¼Œæ± ç”¨å°½æ—¶å¾ªç¯ä½¿ç”¨\"\"\"\n        emoji = self.emoji_pool[self.emoji_index]\n        self.emoji_index = (self.emoji_index + 1) % len(self.emoji_pool)\n        return emoji\n    \n    def replace_emojis(self, text: str) -> str:\n        \"\"\"æ›¿æ¢æ–‡æœ¬ä¸­çš„Emojiä¸ºæ–°çš„Emoji\"\"\"\n        if not text:\n            return text\n            \n        # æå–æ‰€æœ‰Emojiå¹¶å»é‡\n        unique_emojis = set(EMOJI_REGEX.findall(text))\n        if not unique_emojis:\n            return text\n            \n        # åˆ›å»ºEmojiæ˜ å°„å…³ç³»\n        emoji_mapping = {old_emoji: self.get_next_emoji() for old_emoji in unique_emojis}\n        \n        # æ‰§è¡ŒEmojiæ›¿æ¢\n        return EMOJI_REGEX.sub(\n            lambda match: emoji_mapping.get(match.group(0), match.group(0)),\n            text\n        )\n\n\nclass FileProcessor:\n    \"\"\"æ–‡ä»¶å¤„ç†ç±»ï¼Œè´Ÿè´£ä¸åŒæ ¼å¼æ–‡ä»¶çš„Emojiå¤„ç†\"\"\"\n    \n    def __init__(self, emoji_manager: EmojiManager):\n        \"\"\"åˆå§‹åŒ–æ–‡ä»¶å¤„ç†å™¨\"\"\"\n        self.emoji_manager = emoji_manager\n    \n    def process_json(self, content: Union[Dict, List]) -> Union[Dict, List]:\n        \"\"\"é€’å½’å¤„ç†JSONå†…å®¹ä¸­çš„Emoji\"\"\"\n        if isinstance(content, dict):\n            return {k: self.process_json(v) for k, v in content.items()}\n        elif isinstance(content, list):\n            return [self.process_json(item) for item in content]\n        elif isinstance(content, str):\n            return self.emoji_manager.replace_emojis(content)\n        return content\n    \n    def process_text_file(self, content: str, input_path: Path) -> Dict[str, Any]:\n        \"\"\"å¤„ç†æ–‡æœ¬æ–‡ä»¶ï¼ˆéJSONï¼‰çš„Emojiæ›¿æ¢\"\"\"\n        processed_content = self.emoji_manager.replace_emojis(content)\n        return {\n            \"original_file\": str(input_path),\n            \"content\": processed_content\n        }\n    \n    def process_file(self, input_path: Path, output_path: Path) -> None:\n        \"\"\"å¤„ç†å•ä¸ªæ–‡ä»¶ï¼ŒåŒºåˆ†JSONå’ŒéJSONæ ¼å¼\"\"\"\n        try:\n            # è¯»å–æ–‡ä»¶å†…å®¹\n            with open(input_path, 'r', encoding='utf-8') as f:\n                if input_path.suffix.lower() == '.json':\n                    # å¤„ç†JSONæ–‡ä»¶\n                    content = json.load(f)\n                    processed_content = self.process_json(content)\n                    # å†™å…¥å¤„ç†åçš„JSONæ–‡ä»¶\n                    with open(output_path, 'w', encoding='utf-8') as out_f:\n                        json.dump(processed_content, out_f, ensure_ascii=False, indent=2)\n                else:\n                    # å¤„ç†éJSONæ–‡æœ¬æ–‡ä»¶\n                    content = f.read()\n                    processed_data = self.process_text_file(content, input_path)\n                    # å†™å…¥åŒ…å«åŸå§‹æ–‡ä»¶ä¿¡æ¯çš„JSONæ–‡ä»¶\n                    with open(output_path, 'w', encoding='utf-8') as out_f:\n                        json.dump(processed_data, out_f, ensure_ascii=False, indent=2)\n            print(f\"å·²å¤„ç†: {input_path} -> {output_path}\")\n        except Exception as e:\n            print(f\"å¤„ç†æ–‡ä»¶ {input_path} æ—¶å‡ºé”™: {str(e)}\")\n\n\nclass DirectoryProcessor:\n    \"\"\"ç›®å½•å¤„ç†ç±»ï¼Œè´Ÿè´£é€’å½’å¤„ç†ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶\"\"\"\n    \n    def __init__(self, file_processor: FileProcessor):\n        \"\"\"åˆå§‹åŒ–ç›®å½•å¤„ç†å™¨\"\"\"\n        self.file_processor = file_processor\n    \n    def process_directory(self, input_dir: Path, output_dir: Path) -> None:\n        \"\"\"é€’å½’å¤„ç†ç›®å½•ä¸­çš„æ‰€æœ‰æ–‡ä»¶\"\"\"\n        # åˆ›å»ºè¾“å‡ºç›®å½•ï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰\n        output_dir.mkdir(parents=True, exist_ok=True)\n        \n        # å¤„ç†ç›®å½•ä¸­çš„æ¯ä¸ªé¡¹ç›®\n        for item in input_dir.iterdir():\n            if item.is_file():\n                # å¤„ç†æ–‡ä»¶\n                output_file = output_dir / (item.stem + '.json')\n                self.file_processor.process_file(item, output_file)\n            elif item.is_dir() and item != output_dir:\n                # é€’å½’å¤„ç†å­ç›®å½•\n                sub_output_dir = output_dir / item.name\n                self.process_directory(item, sub_output_dir)\n\n\ndef main():\n    \"\"\"ä¸»å‡½æ•°ï¼Œåè°ƒæ•´ä¸ªEmojiå¤„ç†æµç¨‹\"\"\"\n    try:\n        # å®šä¹‰è¾“å…¥è¾“å‡ºç›®å½•\n        current_dir = Path.cwd()\n        input_dir = current_dir / 'emojis'\n        output_dir = input_dir / 'output'\n        \n        # æ£€æŸ¥è¾“å…¥ç›®å½•æ˜¯å¦å­˜åœ¨\n        if not input_dir.exists():\n            print(f\"é”™è¯¯: è¾“å…¥ç›®å½• '{input_dir}' ä¸å­˜åœ¨\")\n            return\n        \n        # åˆå§‹åŒ–Emojiç®¡ç†å™¨å’Œæ–‡ä»¶å¤„ç†å™¨\n        emoji_manager = EmojiManager()\n        file_processor = FileProcessor(emoji_manager)\n        directory_processor = DirectoryProcessor(file_processor)\n        \n        # å¼€å§‹å¤„ç†ç›®å½•\n        print(f\"å¼€å§‹å¤„ç†ç›®å½•: {input_dir}\")\n        directory_processor.process_directory(input_dir, output_dir)\n        \n        print(f\"å¤„ç†å®Œæˆ! ç»“æœä¿å­˜åœ¨: {output_dir}\")\n        \n    except Exception as e:\n        print(f\"ç¨‹åºæ‰§è¡Œå‡ºé”™: {str(e)}\")\n\n\nif __name__ == \"__main__\":\n    main()\n"
}