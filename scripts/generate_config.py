import os
import json
from itertools import cycle

# ===================== åŸºç¡€é…ç½® =====================

PY_DIR = "py"
OUTPUT = "config.json"

PRIORITY_PREFIX = "å‰§é€ç¤¾"

# ===================== Android é€šç”¨ Emoji æ±  =====================
# è¯´æ˜ï¼š
# - å‡ä¸º Android 8+ ç¨³å®šæ˜¾ç¤º
# - æ— è‚¤è‰²ã€æ— ç»„åˆã€æ— å›½æ——
# - å¯æ”¾å¿ƒç”¨äº TV / æ‰‹æœº / å£³

EMOJI_POOL = [
EMOJI_POOL = [
    # åŠ¨ç‰©ä¸è‡ªç„¶
    "ğŸ¶", "ğŸ±", "ğŸ­", "ğŸ¹", "ğŸ°", "ğŸ¦Š", "ğŸ»", "ğŸ¼", "ğŸ¨", "ğŸ¯",
    "ğŸ¦", "ğŸ®", "ğŸ·", "ğŸ¸", "ğŸµ", "ğŸ¦„", "ğŸ”", "ğŸ§", "ğŸ¦", "ğŸ¤",
    "ğŸ", "ğŸ", "ğŸ¦‹", "ğŸ¢", "ğŸ", "ğŸ ", "ğŸ¬", "ğŸ³", "ğŸ¦‘", "ğŸ¦€",
    "ğŸŒ¸", "ğŸŒ»", "ğŸŒ¹", "ğŸŒº", "ğŸŒ¼", "ğŸŒ·", "ğŸŒ±", "ğŸŒ²", "ğŸŒ³", "ğŸŒ´",
    # é£Ÿç‰©ä¸é¥®æ–™
    "ğŸ", "ğŸ", "ğŸ", "ğŸŠ", "ğŸ‹", "ğŸŒ", "ğŸ‰", "ğŸ‡", "ğŸ“", "ğŸ«",
    "ğŸˆ", "ğŸ’", "ğŸ‘", "ğŸ¥­", "ğŸ", "ğŸ¥¥", "ğŸ¥", "ğŸ…", "ğŸ†", "ğŸ¥‘",
    "ğŸ¥¦", "ğŸ¥¬", "ğŸ¥•", "ğŸŒ½", "ğŸŒ¶ï¸", "ğŸ§„", "ğŸ§…", "ğŸ¥”", "ğŸ¥š", "ğŸ",
    "ğŸ¥", "ğŸ¥¯", "ğŸ¥¨", "ğŸ§€", "ğŸ¥“", "ğŸ—", "ğŸ–", "ğŸŒ­", "ğŸ”", "ğŸŸ",
    # æ´»åŠ¨
    "âš½", "ğŸ€", "ğŸˆ", "âš¾", "ğŸ¾", "ğŸ", "ğŸ‰", "ğŸ±", "ğŸ“", "ğŸ¸",
    "ğŸ¥…", "ğŸ’", "ğŸ‘", "ğŸ", "â›³", "ğŸ¹", "ğŸ£", "ğŸ¤¿", "ğŸ¥Š", "ğŸ¥‹",
    "ğŸ¯", "ğŸ³", "ğŸª", "ğŸ›¹", "ğŸ¥Œ", "ğŸ›·", "â›·ï¸", "ğŸ‚", "ğŸ„â€â™‚ï¸", "ğŸŠâ€â™€ï¸",
    "ğŸ®", "ğŸ²", "ğŸ§©", "ğŸ€„", "â™Ÿï¸", "ğŸƒ", "ğŸ§—", "ğŸ†", "ğŸ¥‡", "ğŸ¥ˆ", "ğŸ¥‰",
    # ç‰©ä½“
    "âŒš", "ğŸ“±", "ğŸ’»", "ğŸ–¨ï¸", "ğŸ•¹ï¸", "ğŸ®", "ğŸ“·", "ğŸ“¸", "ğŸ“¹", "ğŸ¥",
    "ğŸ“º", "ğŸ“»", "ğŸ™ï¸", "ğŸšï¸", "ğŸ›ï¸", "â˜ï¸", "ğŸ“", "ğŸ“Ÿ", "ğŸ“ ", "ğŸ”‹",
    "ğŸ”Œ", "ğŸ’¡", "ğŸ”¦", "ğŸ•¯ï¸", "ğŸ›¢ï¸", "ğŸ’°", "ğŸ’³", "ğŸ—ï¸", "ğŸ”‘", "ğŸšª",
    "ğŸ”’", "ğŸ”“", "ğŸ”‘", "ğŸ”", "ğŸ›¡ï¸", "ğŸ§²", "âš–ï¸", "ğŸ”—", "ğŸ§°", "ğŸ”§",
    "ğŸ”¨", "ğŸª“", "â›ï¸", "ğŸ› ï¸", "ğŸ—¡ï¸", "âš”ï¸", "ğŸ”«", "ğŸ¹", "ğŸ›ï¸", "ğŸ›‹ï¸",
    # æ—…è¡Œä¸åœ°ç‚¹
    "ğŸš—", "ğŸš•", "ğŸš™", "ğŸšŒ", "ğŸš", "ğŸï¸", "ğŸš“", "ğŸš‘", "ğŸš’", "ğŸš",
    "ğŸ›»", "ğŸšš", "ğŸš›", "ğŸšœ", "ğŸï¸", "ğŸ›µ", "ğŸš²", "ğŸ›´", "ğŸš¨", "ğŸš”",
    "ğŸš¦", "ğŸš§", "ğŸ›£ï¸", "ğŸ›¤ï¸", "âœˆï¸", "ğŸ›©ï¸", "ğŸš", "ğŸš€", "ğŸ›¸", "â›µ",
    "ğŸš¢", "ğŸ›³ï¸", "â›´ï¸", "ğŸš¤", "ğŸ›¥ï¸", "ğŸ—½", "ğŸ—¼", "ğŸ°", "ğŸ¯", "ğŸŒ‹",
    "ğŸ—»", "ğŸ•ï¸", "ğŸï¸", "ğŸœï¸", "ğŸï¸", "ğŸ–ï¸", "ğŸŸï¸", "ğŸ›ï¸", "ğŸ—ï¸", "ğŸ˜¡", 
    
    "ğŸ˜ˆ", "ğŸ‘¿", "ğŸ‘¹", "ğŸ‘º", "ğŸ’€", "â˜ ï¸", "ğŸ‘»", "ğŸ‘½", "ğŸ‘¾", "ğŸ¤–",
    "ğŸ‘€", "ğŸ‘ï¸", "ğŸ‘…", "ğŸ‘„", "ğŸ§‘", "ğŸ‘¦", "ğŸ‘§", "ğŸ‘¨", "ğŸ‘©", "ğŸ§“",
    "ğŸ‘´", "ğŸ‘µ", "ğŸ§”", "ğŸ‘±â€â™‚ï¸", "ğŸ‘±â€â™€ï¸", "ğŸ‘¨â€ğŸ¦°", "ğŸ‘©â€ğŸ¦°", "ğŸ‘¨â€ğŸ¦±", "ğŸ‘©â€ğŸ¦±", "ğŸ¤¬",
    # ç¬¦å·
    "â¤ï¸", "ğŸ§¡", "ğŸ’›", "ğŸ’š", "ğŸ’™", "ğŸ’œ", "ğŸ¤", "ğŸ–¤", "ğŸ¤", "ğŸ’”",
    "â£ï¸", "ğŸ’•", "ğŸ’", "ğŸ’“", "ğŸ’—", "ğŸ’–", "ğŸ’˜", "ğŸ’", "ğŸ’Ÿ", "â˜®ï¸",
    "âœï¸", "â˜ªï¸", "ğŸ•‰ï¸", "â˜¸ï¸", "âœ¡ï¸", "ğŸ”¯", "ğŸ•", "â˜¯ï¸", "â˜¦ï¸", "ğŸ›",
    "â›", "â™ˆ", "â™‰", "â™Š", "â™‹", "â™Œ", "â™", "â™", "â™", "â™", "â™‘", "â™’", "â™“",
    "ğŸ†—", "ğŸ†•", "ğŸ†™", "ğŸ†’", "ğŸ†“", "â„¹ï¸", "ğŸ†–", "ğŸ†š", "ğŸˆ", "ğŸˆ¯",
    "ğŸˆš", "ğŸˆ·ï¸", "ğŸˆ¶", "ğŸˆ¸", "ğŸˆ´", "ğŸˆ³", "ğŸˆ²", "ğŸ‰", "ğŸ‰‘", "ãŠ—ï¸", "ãŠ™ï¸",
    "ğŸˆ¹", "ğŸˆº", "ğŸˆµ", "ğŸ”", "ğŸ’¯", "ğŸ”¢", "ğŸ”¤", "ğŸ”¡", "ğŸ” ", "ğŸ†", "ğŸ…°ï¸", "ğŸ…±ï¸", "ğŸ…¾ï¸", "ğŸ…¿ï¸",
    "Â©ï¸", "Â®ï¸", "â„¢ï¸", "#ï¸âƒ£", "*ï¸âƒ£", "0ï¸âƒ£", "1ï¸âƒ£", "2ï¸âƒ£", "3ï¸âƒ£", "4ï¸âƒ£", "5ï¸âƒ£", "6ï¸âƒ£", "7ï¸âƒ£", "8ï¸âƒ£", "9ï¸âƒ£", "ğŸ”Ÿ",
    "ğŸ””", "ğŸ”•", "ğŸµ", "ğŸ¶", "ğŸ’¤", "ğŸ’¢", "ğŸ’¬", "ğŸ’­", "ğŸ—¯ï¸", "â™¨ï¸", "ğŸ’¦", "ğŸ’¨", "ğŸ’«", "ğŸ•³ï¸", "ğŸ’£", "ğŸ’¥", "ğŸš¨", "ğŸ’¦",
    "ğŸ’¡", "ğŸ”‘", "ğŸ”’", "ğŸ”“", "ğŸ”", "ğŸ”", "ğŸ›¡ï¸", "ğŸ§²", "ğŸ”—", "âš–ï¸", "ğŸ§°", "ğŸ”§", "ğŸ”¨", "ğŸª“", "â›ï¸", "ğŸ› ï¸", "ğŸ—¡ï¸", "âš”ï¸",
    "ğŸ”«", "ğŸ¹", "ğŸ›ï¸", "ğŸ›‹ï¸", "ğŸ›’", "ğŸ§º", "ğŸ§»", "ğŸ§¼", "ğŸª¥", "ğŸ§½", "ğŸª£", "ğŸ§´", "ğŸ§·", "ğŸ§¹", "ğŸª’", "ğŸ§¯", "ğŸ›ï¸"
]

emoji_cycle = cycle(EMOJI_POOL)

# ===================== å›ºå®šæ¨¡æ¿ =====================

BASE_CONFIG = {
    "wallpaper": "https://imgs.catvod.com/",
    "logo": "https://cnb.cool/junchao.tang/jtv/-/git/raw/main/Pictures/junmeng.gif",
    "spider": "./jar/custom_spider.jpg",
    "sites": []
}

# ===================== æ ¸å¿ƒé€»è¾‘ =====================

def build_sites():
    files = [f for f in os.listdir(PY_DIR) if f.endswith(".py")]

    # 1ï¸âƒ£ æŒ‰â€œå‰§é€ç¤¾â€å‰ç¼€åˆ†ç»„
    priority_files = []
    normal_files = []

    for file in files:
        name = file[:-3]
        if name.startswith(PRIORITY_PREFIX):
            priority_files.append(file)
        else:
            normal_files.append(file)

    # æ’åº
    priority_files.sort()
    normal_files.sort()

    used_emojis = set()
    sites = []

    # 2ï¸âƒ£ å‰§é€ç¤¾ç³»ï¼Œæ°¸è¿œæœ€å‰
    for file in priority_files:
        sites.append(create_site(file, used_emojis))

    # 3ï¸âƒ£ å…¶å®ƒç«™ç‚¹
    for file in normal_files:
        sites.append(create_site(file, used_emojis))

    return sites


def create_site(file: str, used_emojis: set) -> dict:
    raw_name = file[:-3]
    emoji = get_unique_emoji(used_emojis)
    used_emojis.add(emoji)

    return {
        "key": raw_name,
        "name": f"{emoji}â”ƒ{raw_name}",
        "type": 3,
        "api": f"./py/{file}",
        "searchable": 1,
        "quickSearch": 0,
        "filterable": 0,
        "changeable": 0
    }


def get_unique_emoji(used: set) -> str:
    """
    ä¼˜å…ˆè¿”å›æœªä½¿ç”¨è¿‡çš„ Emoji
    Emoji æ± çœŸçš„ç”¨å°½æ—¶ï¼Œæ‰å…è®¸é‡å¤
    """
    for _ in range(len(EMOJI_POOL)):
        e = next(emoji_cycle)
        if e not in used:
            return e
    return next(emoji_cycle)


# ===================== ä¸»å…¥å£ =====================

if __name__ == "__main__":
    BASE_CONFIG["sites"] = build_sites()

    with open(OUTPUT, "w", encoding="utf-8") as f:
        json.dump(BASE_CONFIG, f, ensure_ascii=False, indent=4)

    print(f"âœ… å·²ç”Ÿæˆ {OUTPUT}ï¼Œå…± {len(BASE_CONFIG['sites'])} ä¸ª site")
